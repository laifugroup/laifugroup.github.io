"use strict";(self.webpackChunkshanhaijing_card_game=self.webpackChunkshanhaijing_card_game||[]).push([[966],{29864:(e,r,t)=>{function _regenerator(){var e,r,t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",a=t.toStringTag||"@@toStringTag";function i(t,n,a,c){var l=n&&n.prototype instanceof Generator?n:Generator,u=Object.create(l.prototype);return _regeneratorDefine2(u,"_invoke",function(t,n,a){var c,l,u,g=0,m=a||[],h=!1,w={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function d(r,t){return c=r,l=0,u=e,w.n=t,s}};function d(t,n){for(l=t,u=n,r=0;!h&&g&&!a&&r<m.length;r++){var a,c=m[r],p=w.p,v=c[2];t>3?(a=v===n)&&(u=c[(l=c[4])?5:(l=3,3)],c[4]=c[5]=e):c[0]<=p&&((a=t<2&&p<c[1])?(l=0,w.v=n,w.n=c[1]):p<v&&(a=t<3||c[0]>n||n>v)&&(c[4]=t,c[5]=n,w.n=v,l=0))}if(a||t>1)return s;throw h=!0,n}return function(a,m,p){if(g>1)throw TypeError("Generator is already running");for(h&&1===m&&d(m,p),l=m,u=p;(r=l<2?e:u)||!h;){c||(l?l<3?(l>1&&(w.n=-1),d(l,u)):w.n=u:w.v=u);try{if(g=2,c){if(l||(a="next"),r=c[a]){if(!(r=r.call(c,u)))throw TypeError("iterator result is not an object");if(!r.done)return r;u=r.value,l<2&&(l=0)}else 1===l&&(r=c.return)&&r.call(c),l<2&&(u=TypeError("The iterator does not provide a '"+a+"' method"),l=1);c=e}else if((r=(h=w.n<0)?u:t.call(n,w))!==s)break}catch(r){c=e,l=1,u=r}finally{g=1}}return{value:r,done:h}}}(t,a,c),!0),u}var s={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}r=Object.getPrototypeOf;var c=[][n]?r(r([][n]())):(_regeneratorDefine2(r={},n,function(){return this}),r),l=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(c);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,_regeneratorDefine2(e,a,"GeneratorFunction")),e.prototype=Object.create(l),e}return GeneratorFunction.prototype=GeneratorFunctionPrototype,_regeneratorDefine2(l,"constructor",GeneratorFunctionPrototype),_regeneratorDefine2(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName="GeneratorFunction",_regeneratorDefine2(GeneratorFunctionPrototype,a,"GeneratorFunction"),_regeneratorDefine2(l),_regeneratorDefine2(l,a,"Generator"),_regeneratorDefine2(l,n,function(){return this}),_regeneratorDefine2(l,"toString",function(){return"[object Generator]"}),(_regenerator=function _regenerator(){return{w:i,m:f}})()}function _regeneratorDefine2(e,r,t,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}_regeneratorDefine2=function _regeneratorDefine(e,r,t,n){function o(r,t){_regeneratorDefine2(e,r,function(e){return this._invoke(r,t,e)})}r?a?a(e,r,{value:t,enumerable:!n,configurable:!n,writable:!n}):e[r]=t:(o("next",0),o("throw",1),o("return",2))},_regeneratorDefine2(e,r,t,n)}function asyncGeneratorStep(e,r,t,n,a,s,c){try{var l=e[s](c),u=l.value}catch(e){return void t(e)}l.done?r(u):Promise.resolve(u).then(n,a)}function _asyncToGenerator(e){return function(){var r=this,t=arguments;return new Promise(function(n,a){var s=e.apply(r,t);function _next(e){asyncGeneratorStep(s,n,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(s,n,a,_next,_throw,"throw",e)}_next(void 0)})}}t(52675),t(89463),t(40875),t(10287),t(74423),t(23792),t(26099),t(3362),t(27495),t(21699),t(47764),t(5746),t(42762),t(23500),t(62953),t(48408),t(90407),t(87006),t(90062),t(380),t(49078),t(14822),t(36099),t(16738),t(97474);var n=!1;function switchMode(e){var r=document.getElementById("login-form"),t=document.getElementById("register-form");"register"===e?(r.classList.add("hidden"),t.classList.remove("hidden"),document.getElementById("login-form-element").reset(),clearErrors("login")):(t.classList.add("hidden"),r.classList.remove("hidden"),document.getElementById("register-form-element").reset(),clearErrors("register"))}function handleLogin(e){return _handleLogin.apply(this,arguments)}function _handleLogin(){return(_handleLogin=_asyncToGenerator(_regenerator().m(function _callee(e){var r,t,a,s,c,l,u,g,m,h,w,p,v,y;return _regenerator().w(function(E){for(;;)switch(E.p=E.n){case 0:if(e.preventDefault(),!n){E.n=1;break}return E.a(2);case 1:if(r=e.target,t=new FormData(r),validateLoginForm(a={username:t.get("username").trim(),password:t.get("password")})){E.n=2;break}return E.a(2);case 2:return E.p=2,n=!0,setButtonLoading("login-btn",!0),console.log("🔄 正在登录...",{username:a.username}),s={username:a.username,password:a.password,grantType:"password"},console.log("📤 登录请求数据:",s),E.n=3,UserAPI.login(s);case 3:if(c=E.v,console.log("📥 登录响应:",c),200!==c.code||!c.data){E.n=4;break}l=c.data,u=l.accessToken,g=l.tokenType,m=l.expiresIn,h=l.refreshToken,w={accessToken:u,tokenType:g,expiresIn:m,refreshToken:h,loginTime:Date.now()},localStorage.setItem("auth_token",u),localStorage.setItem("token_data",JSON.stringify(w)),localStorage.setItem("username",a.username),p=new URLSearchParams(window.location.search).get("redirect")||"/",window.location.href=p,E.n=5;break;case 4:throw new Error(c.message||"登录失败");case 5:E.n=7;break;case 6:E.p=6,y=E.v,console.error("❌ 登录失败:",y),v="登录失败，请稍后重试",401===y.status?v="用户名或密码错误":400===y.status?v=y.message||"请求参数错误":429===y.status?v="登录尝试过于频繁，请稍后再试":y.message&&y.message.includes("[grantType]")?v="登录参数错误，请重试":y.message&&(v=y.message),showMessage(v,"error");case 7:return E.p=7,n=!1,setButtonLoading("login-btn",!1),E.f(7);case 8:return E.a(2)}},_callee,null,[[2,6,7,8]])}))).apply(this,arguments)}function handleRegister(e){return _handleRegister.apply(this,arguments)}function _handleRegister(){return(_handleRegister=_asyncToGenerator(_regenerator().m(function _callee2(e){var r,t,a,s,c,l;return _regenerator().w(function(u){for(;;)switch(u.p=u.n){case 0:if(e.preventDefault(),!n){u.n=1;break}return u.a(2);case 1:if(r=e.target,t=new FormData(r),validateRegisterForm(a={username:t.get("username").trim(),password:t.get("password"),confirmPassword:t.get("confirmPassword"),agreeTerms:"on"===t.get("agreeTerms")})){u.n=2;break}return u.a(2);case 2:return u.p=2,n=!0,setButtonLoading("register-btn",!0),console.log("🔄 正在注册...",{username:a.username}),u.n=3,UserAPI.register({username:a.username,password:a.password});case 3:if(s=u.v,console.log("✅ 注册成功:",s),!(s.success||200===s.code)){u.n=4;break}showMessage("注册成功！请登录您的账户","success"),setTimeout(function(){switchMode("login"),document.getElementById("username").value=a.username},2e3),u.n=5;break;case 4:throw new Error(s.message||"注册失败");case 5:u.n=7;break;case 6:u.p=6,l=u.v,console.error("❌ 注册失败:",l),c="注册失败，请稍后重试",409===l.status?c="用户名或邮箱已存在":400===l.status?c="请检查输入信息是否正确":l.message&&(c=l.message),showMessage(c,"error");case 7:return u.p=7,n=!1,setButtonLoading("register-btn",!1),u.f(7);case 8:return u.a(2)}},_callee2,null,[[2,6,7,8]])}))).apply(this,arguments)}function validateLoginForm(e){var r=!0;return clearErrors("login"),e.username?e.username.length<3&&(showFieldError("username-error","用户名至少3个字符"),r=!1):(showFieldError("username-error","请输入用户名或邮箱"),r=!1),e.password?e.password.length<6&&(showFieldError("password-error","密码至少6个字符"),r=!1):(showFieldError("password-error","请输入密码"),r=!1),r}function validateRegisterForm(e){var r=!0;if(clearErrors("register"),e.username)if(e.username.length<3)showFieldError("reg-username-error","用户名至少3个字符"),r=!1;else{/^[a-zA-Z0-9_@.\-]+$/.test(e.username)||(showFieldError("reg-username-error","用户名只能包含字母、数字、下划线、@、.、-"),r=!1)}else showFieldError("reg-username-error","请输入用户名"),r=!1;return e.password?e.password.length<6&&(showFieldError("reg-password-error","密码至少6个字符"),r=!1):(showFieldError("reg-password-error","请输入密码"),r=!1),e.confirmPassword?e.password!==e.confirmPassword&&(showFieldError("reg-confirm-password-error","两次输入的密码不一致"),r=!1):(showFieldError("reg-confirm-password-error","请确认密码"),r=!1),e.agreeTerms||(showMessage("请同意用户协议和隐私政策","error"),r=!1),r}function togglePasswordVisibility(e){var r=document.getElementById(e),t=document.getElementById("toggle-".concat("password"===e?"password":"reg-password"));if(r&&t){var n="password"===r.type;r.type=n?"text":"password";var a=t.querySelector("i");a&&(a.className=n?"icon-eye-off":"icon-eye")}}function handlePasswordStrengthCheck(e){var r=e.target.value,t=document.getElementById("password-strength");if(t){var n=function calculatePasswordStrength(e){var r=0,t="weak",n="弱";e.length>=6&&(r+=1);e.length>=8&&(r+=1);/[a-z]/.test(e)&&(r+=1);/[A-Z]/.test(e)&&(r+=1);/[0-9]/.test(e)&&(r+=1);/[^a-zA-Z0-9]/.test(e)&&(r+=1);r>=5?(t="strong",n="强"):r>=3&&(t="medium",n="中");return{score:r,level:t,text:n,percentage:Math.min(r/6*100,100)}}(r),a=t.querySelector(".strength-fill"),s=t.querySelector(".strength-text");a&&(a.style.width="".concat(n.percentage,"%"),a.className="strength-fill strength-".concat(n.level)),s&&(s.textContent="密码强度：".concat(n.text))}}function handleConfirmPasswordCheck(e){var r=e.target.value,t=document.getElementById("reg-password").value;document.getElementById("reg-confirm-password-error");r&&t!==r?showFieldError("reg-confirm-password-error","两次输入的密码不一致"):clearFieldError("reg-confirm-password-error")}function handleForgotPassword(e){e.preventDefault(),showMessage("忘记密码功能正在开发中...","info")}function setButtonLoading(e,r){var t=document.getElementById(e);if(t){var n=t.querySelector(".btn-text"),a=t.querySelector(".btn-loading");r?(t.disabled=!0,n&&n.classList.add("hidden"),a&&a.classList.remove("hidden")):(t.disabled=!1,n&&n.classList.remove("hidden"),a&&a.classList.add("hidden"))}}function showFieldError(e,r){var t=document.getElementById(e);t&&(t.textContent=r,t.style.display="block")}function clearFieldError(e){var r=document.getElementById(e);r&&(r.textContent="",r.style.display="none")}function clearErrors(e){("login"===e?["username-error","password-error"]:["reg-username-error","reg-password-error","reg-confirm-password-error"]).forEach(function(e){clearFieldError(e)})}document.addEventListener("DOMContentLoaded",function(){console.log("🔄 登录页面初始化..."),function checkAuthStatus(){localStorage.getItem("auth_token")&&(showMessage("您已登录，正在跳转...","success"),setTimeout(function(){window.location.href="/"},1e3))}(),function bindEvents(){var e=document.getElementById("switch-to-register"),r=document.getElementById("switch-to-login");e&&e.addEventListener("click",function(e){e.preventDefault(),switchMode("register")});r&&r.addEventListener("click",function(e){e.preventDefault(),switchMode("login")});var t=document.getElementById("login-form-element");t&&t.addEventListener("submit",handleLogin);var n=document.getElementById("register-form-element");n&&n.addEventListener("submit",handleRegister);var a=document.getElementById("toggle-password"),s=document.getElementById("toggle-reg-password");a&&a.addEventListener("click",function(){return togglePasswordVisibility("password")});s&&s.addEventListener("click",function(){return togglePasswordVisibility("reg-password")});var c=document.getElementById("forgot-password");c&&c.addEventListener("click",handleForgotPassword);var l=document.getElementById("reg-password");l&&l.addEventListener("input",handlePasswordStrengthCheck);var u=document.getElementById("reg-confirm-password");u&&u.addEventListener("input",handleConfirmPasswordCheck);!function bindFormValidation(){var e=document.getElementById("username"),r=document.getElementById("password");e&&e.addEventListener("blur",function(){var r=e.value.trim();r&&r.length<3?showFieldError("username-error","用户名至少3个字符"):clearFieldError("username-error")});r&&r.addEventListener("blur",function(){var e=r.value;e&&e.length<6?showFieldError("password-error","密码至少6个字符"):clearFieldError("password-error")});var t=document.getElementById("reg-username");t&&t.addEventListener("blur",function(){var e=t.value.trim();e&&(e.length<3?showFieldError("reg-username-error","用户名至少3个字符"):/^[a-zA-Z0-9_@.\-]+$/.test(e)?clearFieldError("reg-username-error"):showFieldError("reg-username-error","用户名只能包含字母、数字、下划线、@、.、-"))})}()}(),function checkUrlParams(){var e=new URLSearchParams(window.location.search),r=e.get("mode"),t=e.get("message");"register"===r&&switchMode("register");t&&showMessage(decodeURIComponent(t),"info")}(),console.log("✅ 登录页面初始化完成")}),console.log("✅ 登录页面脚本加载完成")},97474:(e,r,t)=>{t.r(r)}},e=>{e.O(0,[502,955],()=>{return r=29864,e(e.s=r);var r});e.O()}]);