"use strict";(self.webpackChunkshanhaijing_card_game=self.webpackChunkshanhaijing_card_game||[]).push([[966],{29864:(r,e,n)=>{function o(){var r,e,n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function i(n,o,s,a){var i=o&&o.prototype instanceof c?o:c,f=Object.create(i.prototype);return t(f,"_invoke",function(n,o,t){var s,a,i,c=0,f=t||[],d=!1,m={p:0,n:0,v:r,a:g,f:g.bind(r,4),d:function(e,n){return s=e,a=0,i=r,m.n=n,u}};function g(n,o){for(a=n,i=o,e=0;!d&&c&&!t&&e<f.length;e++){var t,s=f[e],g=m.p,w=s[2];n>3?(t=w===o)&&(i=s[(a=s[4])?5:(a=3,3)],s[4]=s[5]=r):s[0]<=g&&((t=n<2&&g<s[1])?(a=0,m.v=o,m.n=s[1]):g<w&&(t=n<3||s[0]>o||o>w)&&(s[4]=n,s[5]=o,m.n=w,a=0))}if(t||n>1)return u;throw d=!0,o}return function(t,f,w){if(c>1)throw TypeError("Generator is already running");for(d&&1===f&&g(f,w),a=f,i=w;(e=a<2?r:i)||!d;){s||(a?a<3?(a>1&&(m.n=-1),g(a,i)):m.n=i:m.v=i);try{if(c=2,s){if(a||(t="next"),e=s[t]){if(!(e=e.call(s,i)))throw TypeError("iterator result is not an object");if(!e.done)return e;i=e.value,a<2&&(a=0)}else 1===a&&(e=s.return)&&e.call(s),a<2&&(i=TypeError("The iterator does not provide a '"+t+"' method"),a=1);s=r}else if((e=(d=m.n<0)?i:n.call(o,m))!==u)break}catch(e){s=r,a=1,i=e}finally{c=1}}return{value:e,done:d}}}(n,s,a),!0),f}var u={};function c(){}function f(){}function d(){}e=Object.getPrototypeOf;var m=[][s]?e(e([][s]())):(t(e={},s,function(){return this}),e),g=d.prototype=c.prototype=Object.create(m);function w(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,d):(r.__proto__=d,t(r,a,"GeneratorFunction")),r.prototype=Object.create(g),r}return f.prototype=d,t(g,"constructor",d),t(d,"constructor",f),f.displayName="GeneratorFunction",t(d,a,"GeneratorFunction"),t(g),t(g,a,"Generator"),t(g,s,function(){return this}),t(g,"toString",function(){return"[object Generator]"}),(o=function(){return{w:i,m:w}})()}function t(r,e,n,o){var s=Object.defineProperty;try{s({},"",{})}catch(r){s=0}t=function(r,e,n,o){function a(e,n){t(r,e,function(r){return this.o(e,n,r)})}e?s?s(r,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):r[e]=n:(a("next",0),a("throw",1),a("return",2))},t(r,e,n,o)}function s(r,e,n,o,t,s,a){try{var i=r[s](a),u=i.value}catch(r){return void n(r)}i.done?e(u):Promise.resolve(u).then(o,t)}function a(r){return function(){var e=this,n=arguments;return new Promise(function(o,t){var a=r.apply(e,n);function i(r){s(a,o,t,i,u,"next",r)}function u(r){s(a,o,t,i,u,"throw",r)}i(void 0)})}}n(52675),n(89463),n(40875),n(10287),n(74423),n(23792),n(26099),n(3362),n(27495),n(21699),n(47764),n(5746),n(42762),n(23500),n(62953),n(48408),n(90407),n(87006),n(90062),n(380),n(49078),n(14822),n(36099),n(16738),n(97474);var i=!1;function u(r){var e=document.getElementById("login-form"),n=document.getElementById("register-form");"register"===r?(e.classList.add("hidden"),n.classList.remove("hidden"),document.getElementById("login-form-element").reset(),T("login")):(n.classList.add("hidden"),e.classList.remove("hidden"),document.getElementById("register-form-element").reset(),T("register"))}function c(r){return f.apply(this,arguments)}function f(){return(f=a(o().m(function r(e){var n,t,s,a,u,c,f,d,m,w,l,h,p,v;return o().w(function(r){for(;;)switch(r.p=r.n){case 0:if(e.preventDefault(),!i){r.n=1;break}return r.a(2);case 1:if(n=e.target,t=new FormData(n),g(s={username:t.get("username").trim(),password:t.get("password")})){r.n=2;break}return r.a(2);case 2:return r.p=2,i=!0,b("login-btn",!0),a={username:s.username,password:s.password,grantType:"password"},r.n=3,UserAPI.login(a);case 3:if(200!==(u=r.v).code||!u.data){r.n=4;break}c=u.data,f=c.accessToken,d=c.tokenType,m=c.expiresIn,w=c.refreshToken,l={accessToken:f,tokenType:d,expiresIn:m,refreshToken:w,loginTime:Date.now()},localStorage.setItem("auth_token",f),localStorage.setItem("token_data",JSON.stringify(l)),localStorage.setItem("username",s.username),h=new URLSearchParams(window.location.search).get("redirect")||"/",window.location.href=h,r.n=5;break;case 4:throw new Error(u.message||"登录失败");case 5:r.n=7;break;case 6:r.p=6,v=r.v,p="登录失败，请稍后重试",401===v.status?p="用户名或密码错误":400===v.status?p=v.message||"请求参数错误":429===v.status?p="登录尝试过于频繁，请稍后再试":v.message&&v.message.includes("[grantType]")?p="登录参数错误，请重试":v.message&&(p=v.message),showMessage(p,"error");case 7:return r.p=7,i=!1,b("login-btn",!1),r.f(7);case 8:return r.a(2)}},r,null,[[2,6,7,8]])}))).apply(this,arguments)}function d(r){return m.apply(this,arguments)}function m(){return(m=a(o().m(function r(e){var n,t,s,a,c,f;return o().w(function(r){for(;;)switch(r.p=r.n){case 0:if(e.preventDefault(),!i){r.n=1;break}return r.a(2);case 1:if(n=e.target,t=new FormData(n),w(s={username:t.get("username").trim(),password:t.get("password"),confirmPassword:t.get("confirmPassword"),agreeTerms:"on"===t.get("agreeTerms")})){r.n=2;break}return r.a(2);case 2:return r.p=2,i=!0,b("register-btn",!0),r.n=3,UserAPI.register({username:s.username,password:s.password});case 3:if(!(a=r.v).success&&200!==a.code){r.n=4;break}showMessage("注册成功！请登录您的账户","success"),setTimeout(function(){u("login"),document.getElementById("username").value=s.username},2e3),r.n=5;break;case 4:throw new Error(a.message||"注册失败");case 5:r.n=7;break;case 6:r.p=6,f=r.v,c="注册失败，请稍后重试",409===f.status?c="用户名或邮箱已存在":400===f.status?c="请检查输入信息是否正确":f.message&&(c=f.message),showMessage(c,"error");case 7:return r.p=7,i=!1,b("register-btn",!1),r.f(7);case 8:return r.a(2)}},r,null,[[2,6,7,8]])}))).apply(this,arguments)}function g(r){var e=!0;return T("login"),r.username?r.username.length<3&&(k("username-error","用户名至少3个字符"),e=!1):(k("username-error","请输入用户名或邮箱"),e=!1),r.password?r.password.length<6&&(k("password-error","密码至少6个字符"),e=!1):(k("password-error","请输入密码"),e=!1),e}function w(r){var e=!0;return T("register"),r.username?r.username.length<3?(k("reg-username-error","用户名至少3个字符"),e=!1):/^[a-zA-Z0-9_@.\-]+$/.test(r.username)||(k("reg-username-error","用户名只能包含字母、数字、下划线、@、.、-"),e=!1):(k("reg-username-error","请输入用户名"),e=!1),r.password?r.password.length<6&&(k("reg-password-error","密码至少6个字符"),e=!1):(k("reg-password-error","请输入密码"),e=!1),r.confirmPassword?r.password!==r.confirmPassword&&(k("reg-confirm-password-error","两次输入的密码不一致"),e=!1):(k("reg-confirm-password-error","请确认密码"),e=!1),r.agreeTerms||(showMessage("请同意用户协议和隐私政策","error"),e=!1),e}function l(r){var e=document.getElementById(r),n=document.getElementById("toggle-".concat("password"===r?"password":"reg-password"));if(e&&n){var o="password"===e.type;e.type=o?"text":"password";var t=n.querySelector("i");t&&(t.className=o?"icon-eye-off":"icon-eye")}}function h(r){var e=r.target.value,n=document.getElementById("password-strength");if(n){var o=function(r){var e=0,n="weak",o="弱";return r.length>=6&&(e+=1),r.length>=8&&(e+=1),/[a-z]/.test(r)&&(e+=1),/[A-Z]/.test(r)&&(e+=1),/[0-9]/.test(r)&&(e+=1),/[^a-zA-Z0-9]/.test(r)&&(e+=1),e>=5?(n="strong",o="强"):e>=3&&(n="medium",o="中"),{score:e,level:n,text:o,percentage:Math.min(e/6*100,100)}}(e),t=n.querySelector(".strength-fill"),s=n.querySelector(".strength-text");t&&(t.style.width="".concat(o.percentage,"%"),t.className="strength-fill strength-".concat(o.level)),s&&(s.textContent="密码强度：".concat(o.text))}}function p(r){var e=r.target.value,n=document.getElementById("reg-password").value;document.getElementById("reg-confirm-password-error"),e&&n!==e?k("reg-confirm-password-error","两次输入的密码不一致"):y("reg-confirm-password-error")}function v(r){r.preventDefault(),showMessage("忘记密码功能正在开发中...","info")}function b(r,e){var n=document.getElementById(r);if(n){var o=n.querySelector(".btn-text"),t=n.querySelector(".btn-loading");e?(n.disabled=!0,o&&o.classList.add("hidden"),t&&t.classList.remove("hidden")):(n.disabled=!1,o&&o.classList.remove("hidden"),t&&t.classList.add("hidden"))}}function k(r,e){var n=document.getElementById(r);n&&(n.textContent=e,n.style.display="block")}function y(r){var e=document.getElementById(r);e&&(e.textContent="",e.style.display="none")}function T(r){("login"===r?["username-error","password-error"]:["reg-username-error","reg-password-error","reg-confirm-password-error"]).forEach(function(r){y(r)})}document.addEventListener("DOMContentLoaded",function(){var r,e,n;localStorage.getItem("auth_token")&&(showMessage("您已登录，正在跳转...","success"),setTimeout(function(){window.location.href="/"},1e3)),function(){var r=document.getElementById("switch-to-register"),e=document.getElementById("switch-to-login");r&&r.addEventListener("click",function(r){r.preventDefault(),u("register")}),e&&e.addEventListener("click",function(r){r.preventDefault(),u("login")});var n=document.getElementById("login-form-element");n&&n.addEventListener("submit",c);var o=document.getElementById("register-form-element");o&&o.addEventListener("submit",d);var t=document.getElementById("toggle-password"),s=document.getElementById("toggle-reg-password");t&&t.addEventListener("click",function(){return l("password")}),s&&s.addEventListener("click",function(){return l("reg-password")});var a=document.getElementById("forgot-password");a&&a.addEventListener("click",v);var i=document.getElementById("reg-password");i&&i.addEventListener("input",h);var f=document.getElementById("reg-confirm-password");f&&f.addEventListener("input",p),function(){var r=document.getElementById("username"),e=document.getElementById("password");r&&r.addEventListener("blur",function(){var e=r.value.trim();e&&e.length<3?k("username-error","用户名至少3个字符"):y("username-error")}),e&&e.addEventListener("blur",function(){var r=e.value;r&&r.length<6?k("password-error","密码至少6个字符"):y("password-error")});var n=document.getElementById("reg-username");n&&n.addEventListener("blur",function(){var r=n.value.trim();r&&(r.length<3?k("reg-username-error","用户名至少3个字符"):/^[a-zA-Z0-9_@.\-]+$/.test(r)?y("reg-username-error"):k("reg-username-error","用户名只能包含字母、数字、下划线、@、.、-"))})}()}(),r=new URLSearchParams(window.location.search),e=r.get("mode"),n=r.get("message"),"register"===e&&u("register"),n&&showMessage(decodeURIComponent(n),"info")})},97474:(r,e,n)=>{n.r(e)}},r=>{r.O(0,[502,955],()=>r(r.s=29864)),r.O()}]);