"use strict";(self.webpackChunkshanhaijing_card_game=self.webpackChunkshanhaijing_card_game||[]).push([[622],{60622:(t,i,n)=>{n(84315),n(7452),n(49078),n(14822),n(36099),n(16738),n(90407),n(87006),n(90062),n(380),n(98027),document.addEventListener("DOMContentLoaded",function(){window.API,window.ThemeManager,window.HeaderModule,window.MessageModule})},98027:(t,i,n)=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function o(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,u(e.key),e)}}function u(t){var i=function(t){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(i)?i:i+""}n(52675),n(89463),n(2259),n(23792),n(47764),n(62953),i.t=!0,i.default=void 0,n(45700),n(89572),n(62010),n(2892),n(26099),n(3362),n(38781),n(23500);var a=function(){return t=function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.currentWeather=0,this.weatherTypes=["sunny","lightning","rain"],this.weatherDurations=[8e3,3e3,6e3],this.thunderAudio=null,this.audioEnabled=!1,this.userInteracted=!1,this.soundEnabled=!1,this.initAudio(),this.setupUserInteraction(),this.setupAudioControl(),this.init()},i=[{key:"initAudio",value:function(){var t=this;try{this.thunderAudio=new Audio("/9tsl.mp3"),this.thunderAudio.preload="auto",this.thunderAudio.volume=.4,this.thunderAudio.addEventListener("canplaythrough",function(){t.audioEnabled=!0}),this.thunderAudio.addEventListener("error",function(i){t.audioEnabled=!1})}catch(i){this.audioEnabled=!1}}},{key:"setupUserInteraction",value:function(){var t=this;this.checkExistingAudioPermission(),window.addEventListener("focus",function(){t.userInteracted||t.checkExistingAudioPermission()}),document.addEventListener("visibilitychange",function(){document.hidden||t.userInteracted||t.checkExistingAudioPermission()})}},{key:"checkExistingAudioPermission",value:function(){var t=this;if(this.thunderAudio&&this.audioEnabled){var i=this.thunderAudio.volume;this.thunderAudio.volume=0;var n=this.thunderAudio.play();void 0!==n&&n.then(function(){t.thunderAudio.pause(),t.thunderAudio.currentTime=0,t.thunderAudio.volume=i,t.userInteracted=!0,t.showAudioReadyNotification()}).catch(function(){t.thunderAudio.volume=i})}}},{key:"enableAudioWithInteraction",value:function(t){var i=this;try{if(this.userInteracted=!0,this.thunderAudio&&this.audioEnabled){var n=this.thunderAudio.volume;this.thunderAudio.volume=.01;var e=this.thunderAudio.play();void 0!==e&&e.then(function(){i.thunderAudio.pause(),i.thunderAudio.currentTime=0,i.thunderAudio.volume=n,i.soundEnabled?i.showNotification("🔊 雷声音效已启用","success"):i.showAudioEnabledNotification()}).catch(function(t){i.thunderAudio.volume=n,i.userInteracted=!1,i.soundEnabled&&(i.soundEnabled=!1,localStorage.setItem("thunderSoundEnabled","false"),i.updateAudioButtonState())})}}catch(o){this.userInteracted=!1,this.soundEnabled&&(this.soundEnabled=!1,localStorage.setItem("thunderSoundEnabled","false"),this.updateAudioButtonState(),this.showNotification("⚡ 音频启用失败，请重试","error"))}}},{key:"showAudioEnabledNotification",value:function(){this.showNotification("🔊 雷声音效已启用","success")}},{key:"showAudioReadyNotification",value:function(){}},{key:"showNotification",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";if(!document.querySelector(".weather-notification")){var n=document.createElement("div");n.className="weather-notification";var e="success"===i?"rgba(34, 197, 94, 0.9)":"info"===i?"rgba(59, 130, 246, 0.9)":"rgba(0, 0, 0, 0.8)";n.style.cssText="\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: ".concat(e,";\n            color: white;\n            padding: 12px 16px;\n            border-radius: 8px;\n            font-size: 14px;\n            font-weight: 500;\n            z-index: 10000;\n            opacity: 0;\n            transform: translateX(100%);\n            transition: all 0.3s ease;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n        "),n.textContent=t,document.body.appendChild(n),setTimeout(function(){n.style.opacity="1",n.style.transform="translateX(0)"},100),setTimeout(function(){n.style.opacity="0",n.style.transform="translateX(100%)",setTimeout(function(){n.parentNode&&n.parentNode.removeChild(n)},300)},2e3)}}},{key:"playThunderSound",value:function(){var t=this;if(this.soundEnabled&&this.thunderAudio&&this.audioEnabled){if(!this.userInteracted)return;try{this.thunderAudio.currentTime=0;var i=this.thunderAudio.play();void 0!==i&&i.then(function(){}).catch(function(i){"NotAllowedError"===i.name&&(t.userInteracted=!1,t.showNotification("🔊 需要重新启用音频权限","info"))})}catch(n){}}}},{key:"init",value:function(){this.createRainDrops(),this.startWeatherCycle()}},{key:"createRainDrops",value:function(){var t=document.getElementById("rain-effect");if(t)for(var i=0;i<100;i++){var n=document.createElement("div");n.className="rain-drop",n.style.left=100*Math.random()+"%",n.style.animationDelay=2*Math.random()+"s",n.style.animationDuration=1+2*Math.random()+"s",t.appendChild(n)}}},{key:"switchWeather",value:function(t){["sunny-effect","lightning-effect","rain-effect"].forEach(function(t){var i=document.getElementById(t);i&&i.classList.remove("active")}),setTimeout(function(){var i=document.getElementById(t+"-effect");i&&i.classList.add("active")},500)}},{key:"startWeatherCycle",value:function(){var t=this,i=function(){var n=t.weatherTypes[t.currentWeather],e=t.weatherDurations[t.currentWeather];t.switchWeather(n),"lightning"===n&&t.createLightningSequence(),setTimeout(function(){t.currentWeather=(t.currentWeather+1)%t.weatherTypes.length,i()},e)};i()}},{key:"createLightningSequence",value:function(){var t=this,i=document.getElementById("lightning-effect");if(i){var n=[500,1200,2e3,2500];n.forEach(function(e,o){setTimeout(function(){0!==o&&o!==n.length-1||t.playThunderSound();var e=document.createElement("div");if(e.className="lightning-flash",i.appendChild(e),Math.random()>.7){var u=document.createElement("div");u.className="lightning-bolt",u.style.left=80*Math.random()+10+"%",u.style.top=20*Math.random()+5+"%",i.appendChild(u)}else{var a=document.createElement("div");a.className="lightning-line",a.style.left=80*Math.random()+10+"%",a.style.top="0",i.appendChild(a)}setTimeout(function(){e.parentNode&&e.parentNode.removeChild(e),i.querySelectorAll(".lightning-bolt, .lightning-line").forEach(function(t){t.parentNode&&"0.05s"!==t.style.animationDelay&&"0.15s"!==t.style.animationDelay&&"0.25s"!==t.style.animationDelay&&"0.35s"!==t.style.animationDelay&&"0.45s"!==t.style.animationDelay&&t.parentNode.removeChild(t)})},600)},e)})}}},{key:"setupAudioControl",value:function(){var t=this;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){return t.initAudioControlButton()}):this.initAudioControlButton()}},{key:"initAudioControlButton",value:function(){var t=this,i=document.getElementById("thunder-toggle");if(i){var n=localStorage.getItem("thunderSoundEnabled");null!==n&&(this.soundEnabled="true"===n),this.updateAudioButtonState(),i.addEventListener("click",function(){t.toggleSound()})}}},{key:"toggleSound",value:function(){var t=this,i=this.soundEnabled;this.soundEnabled=!this.soundEnabled,this.soundEnabled&&!this.userInteracted?this.enableAudioPermissionWithClick().then(function(n){n?(localStorage.setItem("thunderSoundEnabled",t.soundEnabled.toString()),t.updateAudioButtonState(),t.showNotification("🔊 雷声音效已启用","success")):(t.soundEnabled=i,t.updateAudioButtonState())}):(localStorage.setItem("thunderSoundEnabled",this.soundEnabled.toString()),this.updateAudioButtonState(),this.soundEnabled?this.showNotification("🔊 雷声音效已启用","success"):this.showNotification("🔇 雷声音效已关闭","info"))}},{key:"enableAudioPermissionWithClick",value:function(){var t=this;return new Promise(function(i){if(t.userInteracted)i(!0);else if(t.thunderAudio&&t.audioEnabled){var n=t.thunderAudio.volume;t.thunderAudio.volume=.6;var e=t.thunderAudio.play();void 0!==e?e.then(function(){t.thunderAudio.pause(),t.thunderAudio.currentTime=0,t.thunderAudio.volume=n,t.userInteracted=!0,i(!0)}).catch(function(e){t.thunderAudio.volume=n,i(!1)}):i(!1)}else i(!1)})}},{key:"updateAudioButtonState",value:function(){var t=document.getElementById("thunder-toggle");if(t){var i=t.querySelector(".audio-icon"),n=t.querySelector(".audio-text");this.soundEnabled?(t.className="audio-toggle-btn enabled",i&&(i.textContent="🔊"),n&&(n.textContent="关闭雷声"),t.title="点击关闭雷声音效"):(t.className="audio-toggle-btn disabled",i&&(i.textContent="🔇"),n&&(n.textContent="打开雷声"),t.title="点击打开雷声音效")}}},{key:"enableAudioPermission",value:function(){var t=this;return new Promise(function(i){if(t.userInteracted)i(!0);else if(t.thunderAudio&&t.audioEnabled){var n=t.thunderAudio.volume;t.thunderAudio.volume=.01;var e=t.thunderAudio.play();void 0!==e?e.then(function(){t.thunderAudio.pause(),t.thunderAudio.currentTime=0,t.thunderAudio.volume=n,t.userInteracted=!0,i(!0)}).catch(function(e){t.thunderAudio.volume=n,i(!1)}):i(!1)}else i(!1)})}}],i&&o(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,i}();i.default=a,window.WeatherSystem=a}}]);