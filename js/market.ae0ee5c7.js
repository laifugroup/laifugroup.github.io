"use strict";(self.webpackChunkshanhaijing_card_game=self.webpackChunkshanhaijing_card_game||[]).push([[331],{24703:(e,t,n)=>{function _regenerator(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function i(n,r,a,l){var s=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(s.prototype);return _regeneratorDefine2(u,"_invoke",function(n,r,a){var l,s,u,g=0,p=a||[],h=!1,y={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function d(t,n){return l=t,s=0,u=e,y.n=n,c}};function d(n,r){for(s=n,u=r,t=0;!h&&g&&!a&&t<p.length;t++){var a,l=p[t],v=y.p,m=l[2];n>3?(a=m===r)&&(u=l[(s=l[4])?5:(s=3,3)],l[4]=l[5]=e):l[0]<=v&&((a=n<2&&v<l[1])?(s=0,y.v=r,y.n=l[1]):v<m&&(a=n<3||l[0]>r||r>m)&&(l[4]=n,l[5]=r,y.n=m,s=0))}if(a||n>1)return c;throw h=!0,r}return function(a,p,v){if(g>1)throw TypeError("Generator is already running");for(h&&1===p&&d(p,v),s=p,u=v;(t=s<2?e:u)||!h;){l||(s?s<3?(s>1&&(y.n=-1),d(s,u)):y.n=u:y.v=u);try{if(g=2,l){if(s||(a="next"),t=l[a]){if(!(t=t.call(l,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,s<2&&(s=0)}else 1===s&&(t=l.return)&&t.call(l),s<2&&(u=TypeError("The iterator does not provide a '"+a+"' method"),s=1);l=e}else if((t=(h=y.n<0)?u:n.call(r,y))!==c)break}catch(t){l=e,s=1,u=t}finally{g=1}}return{value:t,done:h}}}(n,a,l),!0),u}var c={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(_regeneratorDefine2(t={},r,function(){return this}),t),s=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,_regeneratorDefine2(e,a,"GeneratorFunction")),e.prototype=Object.create(s),e}return GeneratorFunction.prototype=GeneratorFunctionPrototype,_regeneratorDefine2(s,"constructor",GeneratorFunctionPrototype),_regeneratorDefine2(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName="GeneratorFunction",_regeneratorDefine2(GeneratorFunctionPrototype,a,"GeneratorFunction"),_regeneratorDefine2(s),_regeneratorDefine2(s,a,"Generator"),_regeneratorDefine2(s,r,function(){return this}),_regeneratorDefine2(s,"toString",function(){return"[object Generator]"}),(_regenerator=function _regenerator(){return{w:i,m:f}})()}function _regeneratorDefine2(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}_regeneratorDefine2=function _regeneratorDefine(e,t,n,r){function o(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},_regeneratorDefine2(e,t,n,r)}function asyncGeneratorStep(e,t,n,r,a,c,l){try{var s=e[c](l),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,a)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var c=e.apply(t,n);function _next(e){asyncGeneratorStep(c,r,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(c,r,a,_next,_throw,"throw",e)}_next(void 0)})}}n(40875),n(10287),n(3362),n(52675),n(89463),n(28706),n(2008),n(50113),n(74423),n(23792),n(62062),n(34782),n(26910),n(62010),n(26099),n(27495),n(21699),n(47764),n(5746),n(42762),n(23500),n(62953),n(48408),n(90407),n(87006),n(90062),n(380),n(49078),n(14822),n(36099),n(16738),n(46225);var r=[],a=[],c=1,l={N:"bg-gray-500",R:"bg-blue-500",SR:"bg-purple-500",SSR:"bg-yellow-500",UR:"bg-red-500",LR:"bg-gradient-to-r from-purple-500 to-pink-500"},s={1:"N",2:"R",3:"SR",4:"SSR",5:"UR",6:"LR"};function createCardElement(e){var t=document.createElement("div");t.className="card-container relative group cursor-pointer transform transition-all duration-300 hover:scale-105",t.dataset.cardId=e.id;var n=e.rarity||"N",r=l[n]||l.N,a=!0===e.isHolo||"true"===e.isHolo,c=a?"holo-card":"",s=a?'<div class="holo-overlay"></div>':"";t.innerHTML='\n        <div class="bg-white rounded-xl shadow-lg overflow-hidden '.concat(c,'">\n            \x3c!-- 卡牌图片容器 --\x3e\n            <div class="relative h-64 bg-gradient-to-br from-gray-800 to-gray-900 overflow-hidden rounded-xl card-image-container">\n                \x3c!-- 图片加载占位符 --\x3e\n                <div class="card-image-placeholder">\n                    <div class="text-center">\n                        <div class="card-loading-spinner mx-auto mb-2"></div>\n                        <div class="text-white">加载中...</div>\n                    </div>\n                </div>\n                \n                <img src="').concat(e.image,'" alt="').concat(e.name,'" \n                     class="w-full h-full object-cover rounded-xl card-image"\n                     loading="lazy"\n                     data-card-name="').concat(e.name,'">\n                \n                \x3c!-- 闪卡光晕效果 --\x3e\n                ').concat(s,'\n                \n                \x3c!-- 稀有度标签 --\x3e\n                <div class="absolute top-2 right-2 ').concat(r,' text-white px-2 py-1 rounded-full text-xs font-bold rarity-badge">\n                    ').concat(n,"\n                </div>\n                \n                \x3c!-- 闪卡标识 --\x3e\n                ").concat(a?'<div class="absolute top-2 left-2 bg-yellow-400 text-black px-2 py-1 rounded-full text-xs font-bold">✨ HOLO</div>':"",'\n            </div>\n            \n            \x3c!-- 卡牌信息 --\x3e\n            <div class="p-4">\n                <div class="flex justify-between items-start mb-2">\n                    <h3 class="text-lg font-bold text-gray-900 truncate flex-1 mr-2">').concat(e.name,'</h3>\n                    <span class="text-sm text-gray-500 category-tag">').concat(e.category,'</span>\n                </div>\n                \n                <p class="text-sm text-gray-600 mb-3 card-description">').concat(e.description,'</p>\n                \n                <div class="text-xl font-bold text-indigo-600 card-price">¥').concat(e.price.toLocaleString(),"</div>\n            </div>\n        </div>\n    ");var u=t.querySelector(".card-image"),g=t.querySelector(".card-image-placeholder");return u&&g&&(u.onload=function(){this.classList.add("loaded"),g.classList.add("hidden")},u.onerror=function(){this.classList.add("error"),this.src=function createPlaceholderImage(e,t){var n={N:{primary:"#6b7280",secondary:"#4b5563"},R:{primary:"#3b82f6",secondary:"#1e40af"},SR:{primary:"#8b5cf6",secondary:"#6d28d9"},SSR:{primary:"#f59e0b",secondary:"#d97706"},UR:{primary:"#ef4444",secondary:"#dc2626"},LR:{primary:"#ec4899",secondary:"#db2777"}},r=n[t]||n.N,a=document.createElement("canvas"),c=a.getContext("2d");a.width=300,a.height=420;var l=24;c.beginPath(),c.moveTo(l,0),c.lineTo(a.width-l,0),c.arcTo(a.width,0,a.width,l,l),c.lineTo(a.width,a.height-l),c.arcTo(a.width,a.height,a.width-l,a.height,l),c.lineTo(l,a.height),c.arcTo(0,a.height,0,a.height-l,l),c.lineTo(0,l),c.arcTo(0,0,l,0,l),c.closePath(),c.clip();var s=c.createLinearGradient(0,0,a.width,a.height);s.addColorStop(0,r.primary),s.addColorStop(1,r.secondary),c.fillStyle=s,c.fillRect(0,0,a.width,a.height),c.fillStyle="white",c.font="bold 20px Arial, sans-serif",c.textAlign="center",c.textBaseline="middle",c.shadowColor="rgba(0, 0, 0, 0.5)",c.shadowBlur=2,c.shadowOffsetX=1,c.shadowOffsetY=1;for(var u=a.width-40,g=e.split(""),p="",h=[],y=0;y<g.length;y++){var v=p+g[y];c.measureText(v).width>u&&y>0?(h.push(p),p=g[y]):p=v}h.push(p);var m=a.height/2-25*(h.length-1)/2;return h.forEach(function(e,t){c.fillText(e,a.width/2,m+25*t)}),c.font="bold 16px Arial, sans-serif",c.fillStyle="rgba(255, 255, 255, 0.9)",c.fillText(t,a.width/2,a.height-30),a.toDataURL("image/png")}(e.name,n),g.classList.add("hidden")},u.complete&&(u.naturalWidth>0?u.onload():u.onerror())),t}function renderCards(e){var t=document.getElementById("all-cards");t&&(t.innerHTML="",e.forEach(function(e){var n=createCardElement(e);t.appendChild(n)}),bindCardEvents())}function loadHomeData(){return _loadHomeData.apply(this,arguments)}function _loadHomeData(){return(_loadHomeData=_asyncToGenerator(_regenerator().m(function _callee(){var e;return _regenerator().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,window.CardAPI){t.n=1;break}return console.error("❌ CardAPI未初始化"),showErrorState(),t.a(2);case 1:return c=1,t.n=2,loadPage(1);case 2:bindCardEvents(),bindFilterEvents(),handleUrlParameters(),t.n=4;break;case 3:t.p=3,e=t.v,console.error("加载首页数据失败:",e),showErrorState();case 4:return t.a(2)}},_callee,null,[[0,3]])}))).apply(this,arguments)}function loadPage(e){return _loadPage.apply(this,arguments)}function _loadPage(){return(_loadPage=_asyncToGenerator(_regenerator().m(function _callee2(e){var t,n,r,a;return _regenerator().w(function(l){for(;;)switch(l.p=l.n){case 0:return l.p=0,showLoadingState(),console.log("🔄 正在加载第".concat(e,"页数据...")),l.n=1,window.CardAPI.getCardPage({page:e,size:10,sort:"id,DESC",pageDTO:{status:1}});case 1:t=l.v,console.log("📡 第".concat(e,"页API响应:"),t),t&&200===t.code&&t.data?(n=[],t.data.records&&Array.isArray(t.data.records)?(n=t.data.records,console.log("📄 分页数据: 第".concat(t.data.current,"页，每页").concat(t.data.size,"条，共").concat(n.length,"条记录"))):t.data.content&&Array.isArray(t.data.content)?n=t.data.content:Array.isArray(t.data)&&(n=t.data),n.length>0?(r=n.map(function(e){var t,n=(t=e.rarity,s[t]||"N"),r=!0===e.isHolo||"true"===e.isHolo||1===e.isHolo;return{id:e.id,name:e.cardName||e.name||"未知卡牌",image:e.imageUrl||"/icon.png",category:e.series||e.category||"未分类",description:e.lore||e.description||"暂无描述",price:e.marketPrice||0,rarity:n,element:e.element||"",attackPower:e.attackPower||0,defensePower:e.defensePower||0,hp:e.hp||0,skillName:e.skillName||"",skillEffect:e.skillEffect||"",cardNumber:e.cardNumber||"",isHolo:r,_raw:e}}),c=e,renderCards(r),updatePagination(n.length>=10),console.log("✅ 第".concat(e,"页数据加载成功，共").concat(r.length,"张卡牌"))):(console.warn("⚠️ 第".concat(e,"页返回空数据")),showEmptyState())):(console.error("❌ 第".concat(e,"页API响应格式错误:"),t),showErrorState()),window.scrollTo({top:0,behavior:"smooth"}),l.n=3;break;case 2:l.p=2,a=l.v,console.error("❌ 加载第".concat(e,"页数据失败:"),a),showErrorState();case 3:return l.a(2)}},_callee2,null,[[0,2]])}))).apply(this,arguments)}function updatePagination(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=document.getElementById("pagination");if(t)if(1!==c||e){var n="",r=c>1;n+='\n        <button class="pagination-btn px-3 py-2 rounded-lg border transition-colors '.concat(r?"border-gray-300 text-gray-700 hover:bg-gray-50":"border-gray-200 text-gray-400 cursor-not-allowed",'" \n                ').concat(r?'onclick="loadPage('.concat(c-1,')"'):"disabled",'>\n            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>\n            </svg>\n        </button>\n    '),n+='\n        <span class="px-4 py-2 text-gray-700 font-medium">\n            第 '.concat(c," 页\n        </span>\n    ");var a=e;n+='\n        <button class="pagination-btn px-3 py-2 rounded-lg border transition-colors '.concat(a?"border-gray-300 text-gray-700 hover:bg-gray-50":"border-gray-200 text-gray-400 cursor-not-allowed",'" \n                ').concat(a?'onclick="loadPage('.concat(c+1,')"'):"disabled",'>\n            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>\n            </svg>\n        </button>\n    '),t.innerHTML=n}else t.innerHTML=""}function showLoadingState(){var e=document.getElementById("all-cards");e&&(e.innerHTML='\n            <div class="col-span-full flex justify-center items-center py-12">\n                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>\n                <span class="ml-3 text-gray-600">加载中...</span>\n            </div>\n        ')}function showErrorState(){var e=document.getElementById("all-cards");e&&(e.innerHTML='\n            <div class="col-span-full text-center py-12">\n                <div class="text-gray-400 mb-4">\n                    <svg class="mx-auto h-12 w-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>\n                    </svg>\n                </div>\n                <p class="text-gray-600 mb-4">❌ 无法从服务器加载卡牌数据</p>\n                <p class="text-gray-500 mb-4 text-sm">请检查服务器是否正常运行，或查看浏览器控制台获取详细错误信息</p>\n                <button onclick="loadHomeData()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">\n                    🔄 重新加载\n                </button>\n            </div>\n        ')}function showEmptyState(){var e=document.getElementById("all-cards");e&&(e.innerHTML='\n            <div class="col-span-full text-center py-12">\n                <div class="text-gray-400 mb-4">\n                    <svg class="mx-auto h-12 w-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2 2v-5m16 0h-2M4 13h2m13-8V4a1 1 0 00-1-1H7a1 1 0 00-1 1v1m8 0V4.5"></path>\n                    </svg>\n                </div>\n                <p class="text-gray-600 mb-4">📭 没有找到卡牌数据</p>\n                <p class="text-gray-500 text-sm">当前页面没有可显示的卡牌</p>\n            </div>\n        ')}function bindCardEvents(){document.querySelectorAll(".card-container").forEach(function(e){e.addEventListener("click",function(t){t.target.closest("button")||showCardDetail(e.dataset.cardId)})})}function bindFilterEvents(){var e,t=document.getElementById("search-input");t&&t.addEventListener("input",function(t){clearTimeout(e),e=setTimeout(function(){!function searchCards(e){applyAllFilters()}(t.target.value.trim())},300)});var n=document.getElementById("category-filter");n&&n.addEventListener("change",function(e){!function filterByCategory(e){applyAllFilters()}(e.target.value)});var r=document.getElementById("rarity-filter");r&&r.addEventListener("change",function(e){!function filterByRarity(e){applyAllFilters()}(e.target.value)});var a=document.getElementById("price-filter");a&&a.addEventListener("change",function(e){!function filterByPrice(e){applyAllFilters()}(e.target.value)});var c=document.getElementById("sort-filter");c&&c.addEventListener("change",function(e){sortCards(e.target.value)})}function sortCards(e){switch(e){case"price-low":a.sort(function(e,t){return e.price-t.price});break;case"price-high":a.sort(function(e,t){return t.price-e.price});break;case"popular":var t={LR:6,UR:5,SSR:4,SR:3,R:2,N:1};a.sort(function(e,n){var r=1e3*t[e.rarity]+e.price;return 1e3*t[n.rarity]+n.price-r});break;default:a.sort(function(e,t){return t.id-e.id})}c=1,loadPage(1)}function showCardDetail(e){window.location.href="/card-detail.html?id=".concat(e)}function applyAllFilters(){var e,t,n,l,s=[].concat(r),u=(null===(e=document.getElementById("search-input"))||void 0===e?void 0:e.value.trim())||"",g=(null===(t=document.getElementById("category-filter"))||void 0===t?void 0:t.value)||"all",p=(null===(n=document.getElementById("rarity-filter"))||void 0===n?void 0:n.value)||"",h=(null===(l=document.getElementById("price-filter"))||void 0===l?void 0:l.value)||"";if(u&&(s=s.filter(function(e){return e.name.toLowerCase().includes(u.toLowerCase())||e.description.toLowerCase().includes(u.toLowerCase())||e.skillName.toLowerCase().includes(u.toLowerCase())})),"all"!==g&&(s=s.filter(function(e){return e.category===g})),p&&(s=s.filter(function(e){return e.rarity===p})),h){var y=0,v=Infinity;switch(h){case"0-1000":y=0,v=1e3;break;case"1000-5000":y=1e3,v=5e3;break;case"5000-10000":y=5e3,v=1e4;break;case"10000+":y=1e4,v=Infinity}s=s.filter(function(e){return e.price>=y&&e.price<=v})}a=s,c=1,loadPage(1)}function handleUrlParameters(){var e=new URLSearchParams(window.location.search).get("category");if(e){console.log("🔍 检测到分类参数:",e);var t=document.getElementById("category-filter");t&&(t.value=e),applyAllFilters();var n=window.location.pathname;window.history.replaceState({},document.title,n)}}document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){console.log("🚀 开始初始化首页..."),console.log("📋 可用的全局对象:"),console.log("- window.CardAPI:",!!window.CardAPI),console.log("- window.UserAPI:",!!window.UserAPI),console.log("- window.API:",!!window.API),window.CardAPI?(console.log("✅ API模块加载成功，开始加载数据"),loadHomeData()):(console.error("❌ API模块未加载，请检查api.js文件"),showErrorState()),function initScrollAnimations(){var e=new IntersectionObserver(function(e){e.forEach(function(e){e.isIntersecting&&e.target.classList.add("visible")})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll("section").forEach(function(t){t.classList.add("fade-in-up"),e.observe(t)})}()},200)}),window.HomeModule={loadHomeData,showCardDetail,renderCards,filterCards:function filterCards(e){var t=document.getElementById("category-filter");t&&(t.value="all"===e?"all":e),applyAllFilters()},sortCards,loadPage,getCardById:function getCardById(e){return r.find(function(t){return t.id==e})},getCardsByCategory:function getCardsByCategory(e,t){return r.filter(function(n){return n.category===e&&n.id!=t}).slice(0,4)}},window.loadPage=loadPage,window.buyCard=function buyCard(e,t){console.log("购买卡牌:",e,t),function showNotification(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=document.createElement("div");n.className="fixed top-4 right-4 z-50 px-6 py-3 rounded-lg text-white font-medium transform transition-all duration-300 translate-x-full ".concat("success"===t?"bg-green-500":"error"===t?"bg-red-500":"bg-blue-500"),n.textContent=e,document.body.appendChild(n),setTimeout(function(){n.classList.remove("translate-x-full")},100),setTimeout(function(){n.classList.add("translate-x-full"),setTimeout(function(){document.body.removeChild(n)},300)},3e3)}("正在购买 ".concat(t,"..."),"info")}},46225:(e,t,n)=>{n.r(t)}},e=>{e.O(0,[502,955],()=>{return t=24703,e(e.s=t);var t});e.O()}]);