"use strict";(self.webpackChunkshanhaijing_card_game=self.webpackChunkshanhaijing_card_game||[]).push([[622],{60622:(e,t,n)=>{n(84315),n(7452),n(49078),n(14822),n(36099),n(16738),n(90407),n(87006),n(90062),n(380),n(98027),document.addEventListener("DOMContentLoaded",function(){console.log("应用已初始化"),window.API&&console.log("API模块已加载"),window.ThemeManager&&console.log("主题管理器已加载"),window.HeaderModule&&console.log("Header模块已加载"),window.MessageModule&&console.log("Message模块已加载")})},98027:(e,t,n)=>{function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==_typeof(t)?t:t+""}n(52675),n(89463),n(2259),n(23792),n(47764),n(62953),t.__esModule=!0,t.default=void 0,n(45700),n(89572),n(62010),n(2892),n(26099),n(3362),n(38781),n(23500);var o=function(){return function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(function WeatherSystem(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,WeatherSystem),this.currentWeather=0,this.weatherTypes=["sunny","lightning","rain"],this.weatherDurations=[8e3,3e3,6e3],this.thunderAudio=null,this.audioEnabled=!1,this.userInteracted=!1,this.soundEnabled=!1,this.initAudio(),this.setupUserInteraction(),this.setupAudioControl(),this.init()},[{key:"initAudio",value:function initAudio(){var e=this;try{this.thunderAudio=new Audio("/9tsl.mp3"),this.thunderAudio.preload="auto",this.thunderAudio.volume=.4,this.thunderAudio.addEventListener("canplaythrough",function(){console.log("雷声音频已准备就绪"),e.audioEnabled=!0}),this.thunderAudio.addEventListener("error",function(t){console.warn("音频加载错误:",t),e.audioEnabled=!1})}catch(t){console.warn("音频初始化失败:",t),this.audioEnabled=!1}}},{key:"setupUserInteraction",value:function setupUserInteraction(){var e=this;this.checkExistingAudioPermission(),window.addEventListener("focus",function(){e.userInteracted||e.checkExistingAudioPermission()}),document.addEventListener("visibilitychange",function(){document.hidden||e.userInteracted||e.checkExistingAudioPermission()})}},{key:"checkExistingAudioPermission",value:function checkExistingAudioPermission(){var e=this;if(this.thunderAudio&&this.audioEnabled){var t=this.thunderAudio.volume;this.thunderAudio.volume=0;var n=this.thunderAudio.play();void 0!==n&&n.then(function(){e.thunderAudio.pause(),e.thunderAudio.currentTime=0,e.thunderAudio.volume=t,e.userInteracted=!0,console.log("音频权限已存在，无需重新获取"),e.showAudioReadyNotification()}).catch(function(){e.thunderAudio.volume=t,console.log("需要用户交互来启用音频")})}}},{key:"enableAudioWithInteraction",value:function enableAudioWithInteraction(e){var t=this;try{if(this.userInteracted=!0,console.log("用户交互检测到，启用音频功能"),this.thunderAudio&&this.audioEnabled){var n=this.thunderAudio.volume;this.thunderAudio.volume=.01;var o=this.thunderAudio.play();void 0!==o&&o.then(function(){t.thunderAudio.pause(),t.thunderAudio.currentTime=0,t.thunderAudio.volume=n,console.log("音频已解锁，可以正常播放"),t.soundEnabled?t.showNotification("🔊 雷声音效已启用","success"):t.showAudioEnabledNotification()}).catch(function(e){console.warn("音频解锁失败:",e.message),t.thunderAudio.volume=n,t.userInteracted=!1,t.soundEnabled&&(t.soundEnabled=!1,localStorage.setItem("thunderSoundEnabled","false"),t.updateAudioButtonState())})}}catch(i){console.warn("启用音频失败:",i),this.userInteracted=!1,this.soundEnabled&&(this.soundEnabled=!1,localStorage.setItem("thunderSoundEnabled","false"),this.updateAudioButtonState(),this.showNotification("⚡ 音频启用失败，请重试","error"))}}},{key:"showAudioEnabledNotification",value:function showAudioEnabledNotification(){this.showNotification("🔊 雷声音效已启用","success")}},{key:"showAudioReadyNotification",value:function showAudioReadyNotification(){}},{key:"showNotification",value:function showNotification(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";if(!document.querySelector(".weather-notification")){var n=document.createElement("div");n.className="weather-notification";var o="success"===t?"rgba(34, 197, 94, 0.9)":"info"===t?"rgba(59, 130, 246, 0.9)":"rgba(0, 0, 0, 0.8)";n.style.cssText="\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: ".concat(o,";\n            color: white;\n            padding: 12px 16px;\n            border-radius: 8px;\n            font-size: 14px;\n            font-weight: 500;\n            z-index: 10000;\n            opacity: 0;\n            transform: translateX(100%);\n            transition: all 0.3s ease;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n        "),n.textContent=e,document.body.appendChild(n),setTimeout(function(){n.style.opacity="1",n.style.transform="translateX(0)"},100),setTimeout(function(){n.style.opacity="0",n.style.transform="translateX(100%)",setTimeout(function(){n.parentNode&&n.parentNode.removeChild(n)},300)},2e3)}}},{key:"playThunderSound",value:function playThunderSound(){var e=this;if(this.soundEnabled&&this.thunderAudio&&this.audioEnabled){if(!this.userInteracted)return void console.log("音频权限未获得，跳过播放");try{this.thunderAudio.currentTime=0;var t=this.thunderAudio.play();void 0!==t&&t.then(function(){console.log("雷声播放成功")}).catch(function(t){console.warn("音频播放失败:",t.message),"NotAllowedError"===t.name&&(e.userInteracted=!1,e.showNotification("🔊 需要重新启用音频权限","info"))})}catch(n){console.warn("音频播放出错:",n)}}}},{key:"init",value:function init(){this.createRainDrops(),this.startWeatherCycle()}},{key:"createRainDrops",value:function createRainDrops(){var e=document.getElementById("rain-effect");if(e)for(var t=0;t<100;t++){var n=document.createElement("div");n.className="rain-drop",n.style.left=100*Math.random()+"%",n.style.animationDelay=2*Math.random()+"s",n.style.animationDuration=1+2*Math.random()+"s",e.appendChild(n)}}},{key:"switchWeather",value:function switchWeather(e){["sunny-effect","lightning-effect","rain-effect"].forEach(function(e){var t=document.getElementById(e);t&&t.classList.remove("active")}),setTimeout(function(){var t=document.getElementById(e+"-effect");t&&t.classList.add("active")},500)}},{key:"startWeatherCycle",value:function startWeatherCycle(){var e=this,t=function cycleWeather(){var n=e.weatherTypes[e.currentWeather],o=e.weatherDurations[e.currentWeather];e.switchWeather(n),"lightning"===n&&e.createLightningSequence(),setTimeout(function(){e.currentWeather=(e.currentWeather+1)%e.weatherTypes.length,t()},o)};t()}},{key:"createLightningSequence",value:function createLightningSequence(){var e=this,t=document.getElementById("lightning-effect");if(t){var n=[500,1200,2e3,2500];n.forEach(function(o,i){setTimeout(function(){0!==i&&i!==n.length-1||e.playThunderSound();var o=document.createElement("div");if(o.className="lightning-flash",t.appendChild(o),Math.random()>.7){var a=document.createElement("div");a.className="lightning-bolt",a.style.left=80*Math.random()+10+"%",a.style.top=20*Math.random()+5+"%",t.appendChild(a)}else{var u=document.createElement("div");u.className="lightning-line",u.style.left=80*Math.random()+10+"%",u.style.top="0",t.appendChild(u)}setTimeout(function(){o.parentNode&&o.parentNode.removeChild(o),t.querySelectorAll(".lightning-bolt, .lightning-line").forEach(function(e){e.parentNode&&"0.05s"!==e.style.animationDelay&&"0.15s"!==e.style.animationDelay&&"0.25s"!==e.style.animationDelay&&"0.35s"!==e.style.animationDelay&&"0.45s"!==e.style.animationDelay&&e.parentNode.removeChild(e)})},600)},o)})}}},{key:"setupAudioControl",value:function setupAudioControl(){var e=this;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){return e.initAudioControlButton()}):this.initAudioControlButton()}},{key:"initAudioControlButton",value:function initAudioControlButton(){var e=this,t=document.getElementById("thunder-toggle");if(t){var n=localStorage.getItem("thunderSoundEnabled");null!==n&&(this.soundEnabled="true"===n),this.updateAudioButtonState(),t.addEventListener("click",function(){e.toggleSound()})}else console.warn("音效控制按钮未找到")}},{key:"toggleSound",value:function toggleSound(){var e=this,t=this.soundEnabled;this.soundEnabled=!this.soundEnabled,this.soundEnabled&&!this.userInteracted?this.enableAudioPermissionWithClick().then(function(n){n?(localStorage.setItem("thunderSoundEnabled",e.soundEnabled.toString()),e.updateAudioButtonState(),console.log("雷声音效已启用"),e.showNotification("🔊 雷声音效已启用","success")):(e.soundEnabled=t,e.updateAudioButtonState(),console.log("音频权限获取失败"))}):(localStorage.setItem("thunderSoundEnabled",this.soundEnabled.toString()),this.updateAudioButtonState(),console.log("雷声音效",this.soundEnabled?"已启用":"已禁用"),this.soundEnabled?this.showNotification("🔊 雷声音效已启用","success"):this.showNotification("🔇 雷声音效已关闭","info"))}},{key:"enableAudioPermissionWithClick",value:function enableAudioPermissionWithClick(){var e=this;return new Promise(function(t){if(e.userInteracted)t(!0);else if(e.thunderAudio&&e.audioEnabled){var n=e.thunderAudio.volume;e.thunderAudio.volume=.6;var o=e.thunderAudio.play();void 0!==o?o.then(function(){e.thunderAudio.pause(),e.thunderAudio.currentTime=0,e.thunderAudio.volume=n,e.userInteracted=!0,console.log("音频权限已通过按钮点击获得"),t(!0)}).catch(function(o){console.log("按钮点击音频解锁失败:",o.message),e.thunderAudio.volume=n,t(!1)}):t(!1)}else t(!1)})}},{key:"updateAudioButtonState",value:function updateAudioButtonState(){var e=document.getElementById("thunder-toggle");if(e){var t=e.querySelector(".audio-icon"),n=e.querySelector(".audio-text");this.soundEnabled?(e.className="audio-toggle-btn enabled",t&&(t.textContent="🔊"),n&&(n.textContent="关闭雷声"),e.title="点击关闭雷声音效"):(e.className="audio-toggle-btn disabled",t&&(t.textContent="🔇"),n&&(n.textContent="打开雷声"),e.title="点击打开雷声音效")}}},{key:"enableAudioPermission",value:function enableAudioPermission(){var e=this;return new Promise(function(t){if(e.userInteracted)t(!0);else if(e.thunderAudio&&e.audioEnabled){var n=e.thunderAudio.volume;e.thunderAudio.volume=.01;var o=e.thunderAudio.play();void 0!==o?o.then(function(){e.thunderAudio.pause(),e.thunderAudio.currentTime=0,e.thunderAudio.volume=n,e.userInteracted=!0,console.log("音频权限已获得"),t(!0)}).catch(function(o){console.log("音频解锁失败:",o.message),e.thunderAudio.volume=n,t(!1)}):t(!1)}else t(!1)})}}])}();t.default=o;window.WeatherSystem=o}}]);