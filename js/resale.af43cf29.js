"use strict";(self.webpackChunkshanhaijing_card_game=self.webpackChunkshanhaijing_card_game||[]).push([[313],{6087:(e,n,t)=>{t.r(n)},24925:(e,n,t)=>{function _regenerator(){var e,n,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",a=t.toStringTag||"@@toStringTag";function i(t,r,a,s){var l=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(l.prototype);return _regeneratorDefine2(u,"_invoke",function(t,r,a){var s,l,u,g=0,p=a||[],v=!1,y={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function d(n,t){return s=n,l=0,u=e,y.n=t,c}};function d(t,r){for(l=t,u=r,n=0;!v&&g&&!a&&n<p.length;n++){var a,s=p[n],m=y.p,h=s[2];t>3?(a=h===r)&&(u=s[(l=s[4])?5:(l=3,3)],s[4]=s[5]=e):s[0]<=m&&((a=t<2&&m<s[1])?(l=0,y.v=r,y.n=s[1]):m<h&&(a=t<3||s[0]>r||r>h)&&(s[4]=t,s[5]=r,y.n=h,l=0))}if(a||t>1)return c;throw v=!0,r}return function(a,p,m){if(g>1)throw TypeError("Generator is already running");for(v&&1===p&&d(p,m),l=p,u=m;(n=l<2?e:u)||!v;){s||(l?l<3?(l>1&&(y.n=-1),d(l,u)):y.n=u:y.v=u);try{if(g=2,s){if(l||(a="next"),n=s[a]){if(!(n=n.call(s,u)))throw TypeError("iterator result is not an object");if(!n.done)return n;u=n.value,l<2&&(l=0)}else 1===l&&(n=s.return)&&n.call(s),l<2&&(u=TypeError("The iterator does not provide a '"+a+"' method"),l=1);s=e}else if((n=(v=y.n<0)?u:t.call(r,y))!==c)break}catch(n){s=e,l=1,u=n}finally{g=1}}return{value:n,done:v}}}(t,a,s),!0),u}var c={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}n=Object.getPrototypeOf;var s=[][r]?n(n([][r]())):(_regeneratorDefine2(n={},r,function(){return this}),n),l=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(s);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,_regeneratorDefine2(e,a,"GeneratorFunction")),e.prototype=Object.create(l),e}return GeneratorFunction.prototype=GeneratorFunctionPrototype,_regeneratorDefine2(l,"constructor",GeneratorFunctionPrototype),_regeneratorDefine2(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName="GeneratorFunction",_regeneratorDefine2(GeneratorFunctionPrototype,a,"GeneratorFunction"),_regeneratorDefine2(l),_regeneratorDefine2(l,a,"Generator"),_regeneratorDefine2(l,r,function(){return this}),_regeneratorDefine2(l,"toString",function(){return"[object Generator]"}),(_regenerator=function _regenerator(){return{w:i,m:f}})()}function _regeneratorDefine2(e,n,t,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}_regeneratorDefine2=function _regeneratorDefine(e,n,t,r){function o(n,t){_regeneratorDefine2(e,n,function(e){return this._invoke(n,t,e)})}n?a?a(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(o("next",0),o("throw",1),o("return",2))},_regeneratorDefine2(e,n,t,r)}function asyncGeneratorStep(e,n,t,r,a,c,s){try{var l=e[c](s),u=l.value}catch(e){return void t(e)}l.done?n(u):Promise.resolve(u).then(r,a)}t(40875),t(10287),t(3362),t(52675),t(89463),t(28706),t(48598),t(62062),t(26910),t(62010),t(26099),t(27495),t(25440),t(5746),t(42762),t(23500),t(90407),t(87006),t(90062),t(380),t(49078),t(14822),t(36099),t(16738),t(6087);var r=1,a={search:"",category:"",rarity:"",priceRange:"",sort:"newest"},c=!1,s={1:"N",2:"R",3:"SR",4:"SSR",5:"UR",6:"LR"};function loadMarketplaceData(){return _loadMarketplaceData.apply(this,arguments)}function _loadMarketplaceData(){return _loadMarketplaceData=function _asyncToGenerator(e){return function(){var n=this,t=arguments;return new Promise(function(r,a){var c=e.apply(n,t);function _next(e){asyncGeneratorStep(c,r,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(c,r,a,_next,_throw,"throw",e)}_next(void 0)})}}(_regenerator().m(function _callee(){var e,n,t,l,u;return _regenerator().w(function(g){for(;;)switch(g.p=g.n){case 0:if(!c){g.n=1;break}return g.a(2);case 1:return c=!0,showLoading(),g.p=2,console.log("🔄 正在加载第".concat(r,"页二手市场数据...")),g.n=3,window.ResaleAPI.getResalePage({page:r,size:8,sort:a.sort,filters:{search:a.search,category:a.category,rarity:a.rarity,priceRange:a.priceRange}});case 3:e=g.v,console.log("📡 第".concat(r,"页API响应:"),e),e&&200===e.code&&e.data?(n=[],e.data.records&&Array.isArray(e.data.records)&&(n=e.data.records,console.log("📄 分页数据: 第".concat(e.data.current,"页，每页").concat(e.data.size,"条，共").concat(n.length,"条记录"))),n.length>0?(renderMarketplaceCards(t=n.map(function(e){var n,t=(n=e.rarity,s[n]||"N");return{id:e.id,name:e.cardName||e.name||"未知卡牌",image:e.imageUrl||"/icon.png",category:e.series||e.category||"未分类",description:e.lore||e.description||"暂无描述",price:e.price||0,originalPrice:e.originalPrice||e.price||0,rarity:t,element:e.element||"",status:e.status||"available",publishTime:e.publishTime||(new Date).toISOString(),views:e.views||0,favorites:e.favorites||0,tags:e.tags||[],seller:e.seller||{id:1,name:"匿名卖家",avatar:"/icon.png",rating:4.5,verified:!1,online:!1}}})),l=n.length>=8,renderPagination(e.data.total||n.length,8,l),console.log("✅ 第".concat(r,"页数据加载成功，共").concat(t.length,"张卡牌")),hideEmptyState()):(console.warn("⚠️ 第".concat(r,"页返回空数据")),renderMarketplaceCards([]),renderPagination(0,8,!1),showEmptyState())):(console.error("❌ 第".concat(r,"页API响应格式错误:"),e),showError("数据格式错误，请稍后重试")),g.n=5;break;case 4:g.p=4,u=g.v,console.error("加载市场数据失败:",u),showError("加载数据失败，请稍后重试");case 5:return g.p=5,c=!1,hideLoading(),g.f(5);case 6:return g.a(2)}},_callee,null,[[2,4,5,6]])})),_loadMarketplaceData.apply(this,arguments)}function renderMarketplaceCards(e){var n=document.getElementById("marketplace-grid");if(n)if(0!==e.length){var t=e.map(function(e){return function createMarketplaceCardHTML(e){var n={available:"在售",sold:"已售",reserved:"预定"},t={available:"available",sold:"sold",reserved:"reserved"},r=e.originalPrice>e.price?Math.round(100*(1-e.price/e.originalPrice)):0;return'\n        <div class="marketplace-card" data-card-id="'.concat(e.id,'">\n            <div class="relative">\n                <img src="').concat(e.image,'" alt="').concat(e.name,'" class="card-image">\n                \x3c!-- 收藏按钮已移除 --\x3e\n                <div class="card-status ').concat(t[e.status],'">').concat(n[e.status],"</div>\n                ").concat(r>0?'<div class="absolute top-12 right-12 bg-red-500 text-white text-xs px-2 py-1 rounded">'.concat(r,"% OFF</div>"):"",'\n            </div>\n            \n            <div class="card-content">\n                <h3 class="card-title">').concat(e.name,'</h3>\n                \n                <div class="flex items-baseline mb-2">\n                    <span class="card-category">').concat(e.category,'</span>\n                    <span class="card-rarity ').concat(e.rarity,'">').concat(e.rarity,'</span>\n                </div>\n                \n                <div class="seller-info">\n                    <div class="card-seller">\n                        <img src="').concat(e.seller.avatar,'" alt="').concat(e.seller.name,'" class="seller-avatar">\n                        <span class="seller-name">').concat(e.seller.name,"</span>\n                        ").concat(e.seller.verified?'<span class="seller-verified">✓</span>':"",'\n                        <div class="seller-rating">\n                            <span class="rating-stars">★</span>\n                            <span class="rating-score">').concat(e.seller.rating,'</span>\n                        </div>\n                    </div>\n                    <div class="flex items-center text-xs text-gray-500">\n                        <span class="status-indicator ').concat(e.seller.online?"online":"offline",'"></span>\n                        ').concat(e.seller.online?"在线":"离线",'\n                        <span class="ml-4">').concat(e.views,' 浏览</span>\n                        <span class="ml-2">').concat(e.favorites,' 收藏</span>\n                    </div>\n                </div>\n                \n                <div class="card-price">\n                    ¥').concat(e.price.toLocaleString(),"\n                    ").concat(e.originalPrice>e.price?'<span class="text-sm text-gray-400 line-through ml-2">¥'.concat(e.originalPrice.toLocaleString(),"</span>"):"",'\n                </div>\n                \n                <p class="text-sm text-gray-600 mb-3 line-clamp-2">').concat(e.description,"</p>\n                \n                ").concat(e.tags.length>0?'\n                    <div class="tag-cloud mb-4">\n                        '.concat(e.tags.map(function(e){return'<span class="tag">'.concat(e,"</span>")}).join(""),"\n                    </div>\n                "):"",'\n                \n                <div class="card-actions mt-4">\n                    ').concat("available"===e.status?'\n                        <button class="btn-primary" onclick="buyCard('.concat(e.id,')">立即购买</button>\n                        <button class="btn-secondary" onclick="contactSeller(').concat(e.id,')">联系卖家</button>\n                    '):"reserved"===e.status?'\n                        <button class="btn-secondary" disabled>已预定</button>\n                        <button class="btn-secondary" onclick="contactSeller('.concat(e.id,')">联系卖家</button>\n                    '):'\n                        <button class="btn-secondary" disabled>已售出</button>\n                        <button class="btn-secondary" onclick="viewSimilar('.concat(e.id,')">查看相似</button>\n                    '),"\n                </div>\n            </div>\n        </div>\n    ")}(e)}).join("");n.innerHTML=t,function bindCardEvents(){document.querySelectorAll(".marketplace-card").forEach(function(e){e.addEventListener("click",function(){!function viewCardDetail(e){console.log("查看卡牌详情: ".concat(e)),window.location.href="/card-detail.html?id=".concat(e)}(this.dataset.cardId)})})}()}else n.innerHTML=""}function renderPagination(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=document.getElementById("pagination");if(a)if(1!==r||t){var c="",s=r>1;c+='\n        <button class="pagination-btn px-3 py-2 rounded-lg border transition-colors '.concat(s?"border-gray-300 text-gray-700 hover:bg-gray-50":"border-gray-200 text-gray-400 cursor-not-allowed",'" \n                ').concat(s?'onclick="changePage('.concat(r-1,')"'):"disabled",'>\n            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>\n            </svg>\n        </button>\n    '),c+='\n        <span class="px-4 py-2 text-gray-700 font-medium">\n            第 '.concat(r," 页\n        </span>\n    ");var l=t;c+='\n        <button class="pagination-btn px-3 py-2 rounded-lg border transition-colors '.concat(l?"border-gray-300 text-gray-700 hover:bg-gray-50":"border-gray-200 text-gray-400 cursor-not-allowed",'" \n                ').concat(l?'onclick="changePage('.concat(r+1,')"'):"disabled",'>\n            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>\n            </svg>\n        </button>\n    '),a.innerHTML=c}else a.innerHTML=""}function showLoading(){var e=document.getElementById("loading-state"),n=document.getElementById("marketplace-grid");e&&e.classList.remove("hidden"),n&&n.classList.add("hidden")}function hideLoading(){var e=document.getElementById("loading-state"),n=document.getElementById("marketplace-grid");e&&e.classList.add("hidden"),n&&n.classList.remove("hidden")}function showEmptyState(){var e=document.getElementById("empty-state");e&&e.classList.remove("hidden")}function hideEmptyState(){var e=document.getElementById("empty-state");e&&e.classList.add("hidden")}function showError(e){console.error(e)}document.addEventListener("DOMContentLoaded",function(){if(console.log("🚀 二手市场页面初始化开始"),!window.ResaleAPI)return console.error("❌ ResaleAPI未初始化"),void showError("API未加载，请刷新页面重试");!function bindEvents(){var e,n=document.getElementById("search-input");n&&n.addEventListener("input",function(){var n=this;clearTimeout(e),e=setTimeout(function(){a.search=n.value.trim(),r=1,loadMarketplaceData()},500)});["category-filter","rarity-filter","price-filter","sort-filter"].forEach(function(e){var n=document.getElementById(e);n&&n.addEventListener("change",function(){var n=e.replace("-filter","");"price"===n?a.priceRange=this.value:a[n]=this.value,r=1,loadMarketplaceData()})})}(),loadMarketplaceData(),console.log("✅ 二手市场页面初始化完成")}),window.changePage=function changePage(e){r=e,loadMarketplaceData(),window.scrollTo({top:0,behavior:"smooth"})},window.clearFilters=function clearFilters(){a={search:"",category:"",rarity:"",priceRange:"",sort:"newest"},document.getElementById("search-input").value="",document.getElementById("category-filter").value="",document.getElementById("rarity-filter").value="",document.getElementById("price-filter").value="",document.getElementById("sort-filter").value="newest",r=1,loadMarketplaceData()},window.buyCard=function buyCard(e){console.log("购买卡牌: ".concat(e)),confirm("确定要购买这张卡牌吗？")&&alert("跳转到支付页面...")},window.contactSeller=function contactSeller(e){console.log("联系卖家: ".concat(e)),alert("正在联系卖家...")},window.viewSimilar=function viewSimilar(e){console.log("查看相似卡牌: ".concat(e)),r=1,loadMarketplaceData()},console.log("✅ 市场页面脚本已加载")}},e=>{e.O(0,[502,955],()=>{return n=24925,e(e.s=n);var n});e.O()}]);