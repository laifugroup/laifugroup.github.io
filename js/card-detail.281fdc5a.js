"use strict";(self.webpackChunkshanhaijing_card_game=self.webpackChunkshanhaijing_card_game||[]).push([[661],{16485:(e,t,n)=>{n.r(t)},81935:(e,t,n)=>{function _regenerator(){var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function i(n,a,r,l){var s=a&&a.prototype instanceof Generator?a:Generator,u=Object.create(s.prototype);return _regeneratorDefine2(u,"_invoke",function(n,a,r){var l,s,u,p=0,g=r||[],m=!1,h={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function d(t,n){return l=t,s=0,u=e,h.n=n,c}};function d(n,a){for(s=n,u=a,t=0;!m&&p&&!r&&t<g.length;t++){var r,l=g[t],v=h.p,y=l[2];n>3?(r=y===a)&&(u=l[(s=l[4])?5:(s=3,3)],l[4]=l[5]=e):l[0]<=v&&((r=n<2&&v<l[1])?(s=0,h.v=a,h.n=l[1]):v<y&&(r=n<3||l[0]>a||a>y)&&(l[4]=n,l[5]=a,h.n=y,s=0))}if(r||n>1)return c;throw m=!0,a}return function(r,g,v){if(p>1)throw TypeError("Generator is already running");for(m&&1===g&&d(g,v),s=g,u=v;(t=s<2?e:u)||!m;){l||(s?s<3?(s>1&&(h.n=-1),d(s,u)):h.n=u:h.v=u);try{if(p=2,l){if(s||(r="next"),t=l[r]){if(!(t=t.call(l,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,s<2&&(s=0)}else 1===s&&(t=l.return)&&t.call(l),s<2&&(u=TypeError("The iterator does not provide a '"+r+"' method"),s=1);l=e}else if((t=(m=h.n<0)?u:n.call(a,h))!==c)break}catch(t){l=e,s=1,u=t}finally{p=1}}return{value:t,done:m}}}(n,r,l),!0),u}var c={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}t=Object.getPrototypeOf;var l=[][a]?t(t([][a]())):(_regeneratorDefine2(t={},a,function(){return this}),t),s=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,_regeneratorDefine2(e,r,"GeneratorFunction")),e.prototype=Object.create(s),e}return GeneratorFunction.prototype=GeneratorFunctionPrototype,_regeneratorDefine2(s,"constructor",GeneratorFunctionPrototype),_regeneratorDefine2(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName="GeneratorFunction",_regeneratorDefine2(GeneratorFunctionPrototype,r,"GeneratorFunction"),_regeneratorDefine2(s),_regeneratorDefine2(s,r,"Generator"),_regeneratorDefine2(s,a,function(){return this}),_regeneratorDefine2(s,"toString",function(){return"[object Generator]"}),(_regenerator=function _regenerator(){return{w:i,m:f}})()}function _regeneratorDefine2(e,t,n,a){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}_regeneratorDefine2=function _regeneratorDefine(e,t,n,a){function o(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},_regeneratorDefine2(e,t,n,a)}function asyncGeneratorStep(e,t,n,a,r,c,l){try{var s=e[c](l),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(a,r)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var c=e.apply(t,n);function _next(e){asyncGeneratorStep(c,a,r,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(c,a,r,_next,_throw,"throw",e)}_next(void 0)})}}n(40875),n(10287),n(3362),n(52675),n(89463),n(28706),n(74423),n(23792),n(62062),n(34782),n(62010),n(26099),n(27495),n(38781),n(21699),n(47764),n(25440),n(5746),n(42762),n(23500),n(62953),n(48408),n(90407),n(87006),n(90062),n(380),n(49078),n(14822),n(36099),n(16738),n(16485);var a={N:"bg-gray-500",R:"bg-blue-500",SR:"bg-purple-500",SSR:"bg-yellow-500",UR:"bg-red-500",LR:"bg-gradient-to-r from-purple-500 to-pink-500"},r={1:"N",2:"R",3:"SR",4:"SSR",5:"UR",6:"LR"},c={N:"普通卡",R:"稀有卡",SR:"超极稀有卡",SSR:"超超极稀有卡",UR:"终极稀有卡",LR:"传说级稀有卡"};function getRarityFromNumber(e){return r[e]||"N"}function _loadCardDetail(){return(_loadCardDetail=_asyncToGenerator(_regenerator().m(function _callee(e){var t,n,a,r;return _regenerator().w(function(c){for(;;)switch(c.p=c.n){case 0:if(c.p=0,document.getElementById("card-detail-container")){c.n=1;break}return c.a(2);case 1:if(console.log("🔄 正在加载卡牌详情，ID:",e),t=null,c.p=2,!window.CardAPI||!window.CardAPI.getCardDetail){c.n=4;break}return c.n=3,window.CardAPI.getCardDetail(e);case 3:(n=c.v)&&200===n.code&&n.data?(t={id:n.data.id,name:n.data.cardName,cardNumber:n.data.cardNumber,cardType:n.data.cardType,rarity:getRarityFromNumber(n.data.rarity),element:n.data.element,series:n.data.series,hp:n.data.hp,attackPower:n.data.attackPower,defensePower:n.data.defensePower,skillName:n.data.skillName,skillEffect:n.data.skillEffect,lore:n.data.lore,price:n.data.marketPrice,image:n.data.imageUrl,isHolo:n.data.isHolo,status:n.data.status,userId:n.data.userId,createdAt:n.data.createdAt,updatedAt:n.data.updatedAt,category:n.data.element||"神兽",description:n.data.lore||"暂无描述"},console.log("✅ 卡牌详情加载成功:",t)):console.error("❌ API响应格式错误:",n),c.n=5;break;case 4:console.warn("⚠️ CardAPI.getCardDetail 不可用");case 5:c.n=7;break;case 6:c.p=6,a=c.v,console.error("❌ API调用失败:",a.message);case 7:if(!t&&window.HomeModule&&window.HomeModule.getCardById&&(t=window.HomeModule.getCardById(e))&&console.log("✅ 从缓存中获取卡牌详情成功:",t),t){c.n=8;break}return showError("无法加载卡牌详情，请返回首页重试"),c.a(2);case 8:renderCardDetail(t),loadRelatedCards(t.category,t.id),document.title="".concat(t.name," - 卡牌详情 - 新山海经"),c.n=10;break;case 9:c.p=9,r=c.v,console.error("加载卡牌详情失败:",r),showError("加载卡牌详情时发生错误，请刷新页面重试");case 10:return c.a(2)}},_callee,null,[[2,6],[0,9]])}))).apply(this,arguments)}function renderCardDetail(e){var t=document.getElementById("card-detail-container");if(t){h=e.image?[e.image]:[],e.imageVariants&&Array.isArray(e.imageVariants)&&(h=h.concat(e.imageVariants)),v=0,t.innerHTML='\n        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 p-6 card-detail-grid">\n            \x3c!-- 卡牌图片 - 竖向展示 --\x3e\n            <div class="card-image-section">\n                \x3c!-- Three.js 3D卡牌展示容器 --\x3e\n        <div id="card-3d-container" class="card-3d-container h-[650px] mb-4 rounded-xl overflow-hidden relative">\n                    \x3c!-- Three.js将在这里渲染 --\x3e\n                </div>\n                \n                \x3c!-- 卡牌导航控制 --\x3e\n                <div class="flex justify-between items-center mt-4">\n                    <button id="prev-card-btn" class="card-nav-btn bg-white border border-gray-300 rounded-full p-2 shadow-sm hover:bg-gray-50 transition-colors">\n                        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>\n                        </svg>\n                    </button>\n                    \n                    <div class="card-pagination">\n                        <span id="current-card-index">1</span> / <span id="total-cards">'.concat(h.length,'</span>\n                    </div>\n                    \n                    <button id="next-card-btn" class="card-nav-btn bg-white border border-gray-300 rounded-full p-2 shadow-sm hover:bg-gray-50 transition-colors">\n                        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>\n                        </svg>\n                    </button>\n                </div>\n                \n                \x3c!-- 稀有度标签 --\x3e\n                <div class="rarity-badge ').concat(a[e.rarity],' mt-4 inline-block">\n                    ').concat(e.rarity," - ").concat(function getRarityChineseName(e){return c[e]||"普通卡"}(e.rarity),'\n                </div>\n                \n                \x3c!-- 卡牌故事 - 移到这里 --\x3e\n                <div class="mt-6 bg-gray-800 bg-opacity-80 rounded-xl p-4 border border-gray-600">\n                    <h3 class="text-lg font-bold text-white mb-3 flex items-center">\n                        <svg class="w-5 h-5 mr-2 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">\n                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>\n                        </svg>\n                        故事\n                    </h3>\n                    <div class="card-story-content text-sm text-gray-300 leading-relaxed max-h-48 overflow-y-auto">\n                        ').concat(function generateCardStory(e){var t={神兽:'\n            <p class="mb-4"><strong>'.concat(e.name,"</strong>，传说中的神兽，据《山海经》记载，它生活在东方的神山之巅，掌管着天地间的").concat(Math.random()>.5?"雷电":"风雨",'。</p>\n            <p class="mb-4">相传在远古时期，').concat(e.name,"曾助黄帝平定天下，是上古时代的神圣守护者。它拥有着不可思议的力量，能够").concat(Math.random()>.5?"呼风唤雨":"移山填海",'，是人间秩序的维护者。</p>\n            <p class="mb-4">每当').concat(e.name,"现身，必有祥瑞降临。古籍中记载，见到").concat(e.name,"的人会得到上天的祝福，一生平安喜乐。</p>\n            <p>如今，").concat(e.name,"的形象被制作成了珍贵的收藏卡牌，承载着古老的传说与祝福。</p>\n        "),妖怪:'\n            <p class="mb-4"><strong>'.concat(e.name,'</strong>，古老传说中的奇异妖怪，栖息于深山老林之中，常在夜晚出没。</p>\n            <p class="mb-4">相传').concat(e.name,'拥有变化之术，能够幻化成人形迷惑世人。它既有邪恶的一面，也有善良的一面，对待善良的人会给予帮助，对待恶人则会施以惩罚。</p>\n            <p class="mb-4">在民间故事中，').concat(e.name,"曾多次与道士斗法，展现出非凡的法力。有些地方还流传着").concat(e.name,"与凡人结为伴侣的爱情故事。</p>\n            <p>这张卡牌记录了").concat(e.name,"的真实形态，据说在月圆之夜，卡牌会微微发光，仿佛").concat(e.name,"的灵魂依然存在于其中。</p>\n        "),仙人:'\n            <p class="mb-4"><strong>'.concat(e.name,'</strong>，道教传说中的仙人，修道千年，已得长生不老之术。</p>\n            <p class="mb-4">相传').concat(e.name,'曾是凡人，通过不懈的修行和对道的领悟，最终得道成仙。它精通丹道，能炼制各种灵丹妙药，救死扶伤。</p>\n            <p class="mb-4">').concat(e.name,"居住在仙境之中，偶尔会下凡济世救人。民间流传着许多").concat(e.name,"点化凡人、惩恶扬善的故事。</p>\n            <p>这张卡牌据说含有").concat(e.name,"的一丝仙气，能够为持有者带来好运和智慧。</p>\n        "),法宝:'\n            <p class="mb-4"><strong>'.concat(e.name,'</strong>，传说中的神秘法宝，拥有不可思议的力量。</p>\n            <p class="mb-4">相传此宝由上古神匠所铸，历经千年，吸收天地精华，已成灵物。它能').concat(Math.random()>.5?"呼风唤雨":"移山填海",'，是修道者梦寐以求的神器。</p>\n            <p class="mb-4">在古代传说中，').concat(e.name,"曾多次出现在关键历史时刻，改变战局，拯救苍生。它的持有者往往是当世英雄或隐世高人。</p>\n            <p>这张卡牌记录了").concat(e.name,"的真实形态和力量，是收藏家们争相追逐的珍品。</p>\n        "),地理:'\n            <p class="mb-4"><strong>'.concat(e.name,"</strong>，《山海经》中记载的神秘地域，位于").concat(Math.random()>.5?"东方神州":"西方大荒",'。</p>\n            <p class="mb-4">相传此地灵气充沛，奇花异草遍地，是众多神兽和仙人的栖息之所。在古代，能够到达').concat(e.name,'的人寥寥无几，都是有大机缘的修行者。</p>\n            <p class="mb-4">').concat(e.name,"的地貌奇特，有").concat(Math.random()>.5?"高耸入云的山峰":"深不见底的峡谷","，还有传说中能治百病的灵泉。</p>\n            <p>这张卡牌记录了").concat(e.name,"的壮丽景色，让人仿佛置身其中，感受那神秘而古老的氛围。</p>\n        "),default:'\n            <p class="mb-4"><strong>'.concat(e.name,'</strong>，《山海经》中记载的神秘存在，拥有着不为人知的力量和历史。</p>\n            <p class="mb-4">相传在远古时期，').concat(e.name,'曾与众多神话人物有过交集，留下了许多传奇故事。它的出现往往预示着重大事件的发生。</p>\n            <p class="mb-4">在民间流传的故事中，').concat(e.name,"既可能是祥瑞的象征，也可能带来灾难。人们对它既敬畏又向往。</p>\n            <p>这张卡牌记录了").concat(e.name,"的真实形态，是了解中国古代神话文化的重要窗口。</p>\n        ")};return t[e.category]||t.default}(e),'\n                    </div>\n                </div>\n            </div>\n            \n            \x3c!-- 卡牌信息 --\x3e\n            <div class="card-info">\n                <div class="flex justify-between items-start">\n                    <h1 class="card-name">').concat(e.name,'</h1>\n                    <span class="card-category">').concat(e.element||e.category,'</span>\n                </div>\n                \n                \x3c!-- 卡牌编号 --\x3e\n                <div class="text-sm text-gray-500 mb-2">').concat(e.cardNumber,'</div>\n                \n                \x3c!-- 卡牌描述/传说 --\x3e\n                <p class="card-description">').concat(e.lore||e.description,'</p>\n                \n                \x3c!-- 卡牌属性信息 --\x3e\n                <div class="grid grid-cols-3 gap-4 my-4 p-4 bg-gray-50 rounded-lg">\n                    <div class="text-center">\n                        <div class="text-sm text-gray-500">生命值</div>\n                        <div class="text-lg font-bold text-red-600">').concat(e.hp||0,'</div>\n                    </div>\n                    <div class="text-center">\n                        <div class="text-sm text-gray-500">攻击力</div>\n                        <div class="text-lg font-bold text-orange-600">').concat(e.attackPower||0,'</div>\n                    </div>\n                    <div class="text-center">\n                        <div class="text-sm text-gray-500">防御力</div>\n                        <div class="text-lg font-bold text-blue-600">').concat(e.defensePower||0,"</div>\n                    </div>\n                </div>\n                \n                \x3c!-- 技能信息 --\x3e\n                ").concat(e.skillName?'\n                <div class="mb-4 p-4 bg-gray-50 rounded-lg">\n                    <div class="font-semibold text-indigo-800 mb-2">技能：'.concat(e.skillName,'</div>\n                    <div class="text-sm text-indigo-600">').concat(e.skillEffect,"</div>\n                </div>\n                "):"",'\n                \n                <div class="card-price">¥').concat((e.price||0).toLocaleString(),'</div>\n                \n                \x3c!-- 数量选择 --\x3e\n                <div class="quantity-selector">\n                    <button class="quantity-btn" onclick="updateQuantity(-1)">\n                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>\n                        </svg>\n                    </button>\n                    <input type="number" class="quantity-input" id="quantity" value="1" min="1" max="99">\n                    <button class="quantity-btn" onclick="updateQuantity(1)">\n                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>\n                        </svg>\n                    </button>\n                </div>\n                \n                \x3c!-- 按钮组 --\x3e\n                <div class="button-group">\n                    <button class="flex-1 bg-indigo-600 text-white py-3 px-6 rounded-lg hover:bg-indigo-700 transition-colors font-medium"\n                            onclick="buyCard(').concat(e.id,", '").concat(e.name,"', ").concat(e.price,')">\n                        立即购买\n                    </button>\n                    <button class="flex-1 bg-yellow-500 text-white py-3 px-6 rounded-lg hover:bg-yellow-600 transition-colors font-medium">\n                        立即购买\n                    </button>\n                </div>\n                \n                \x3c!-- 卡牌属性 --\x3e\n                <div class="card-attributes">\n                  \n                    <div class="attribute-item">\n                        <span class="attribute-label">编号</span>\n                        <span class="attribute-value">').concat(e.cardNumber,'</span>\n                    </div>\n                    <div class="attribute-item">\n                        <span class="attribute-label">稀有度</span>\n                        <span class="attribute-value">').concat(e.rarity,'</span>\n                    </div>\n                    \n                    <div class="attribute-item">\n                        <span class="attribute-label">系列</span>\n                        <span class="attribute-value">').concat(e.series,'</span>\n                    </div>\n                    <div class="attribute-item">\n                        <span class="attribute-label">闪卡</span>\n                        <span class="attribute-value">').concat(e.isHolo?"是":"否","</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ");var n=document.getElementById("quantity");n&&n.addEventListener("change",function(){var e=parseInt(n.value);isNaN(e)||e<1?n.value=1:e>99&&(n.value=99)}),document.querySelectorAll(".thumbnail-item").forEach(function(e){e.addEventListener("click",function(){var t=parseInt(e.dataset.index);document.querySelectorAll(".thumbnail-item").forEach(function(e){return e.classList.remove("active")}),e.classList.add("active"),updateCardTexture(h[t])})}),initCardThreeJS(e.image,e)}}document.addEventListener("DOMContentLoaded",function(){var e=new URLSearchParams(window.location.search).get("id");e?setTimeout(function(){window.CardAPI?function loadCardDetail(e){return _loadCardDetail.apply(this,arguments)}(e):showError("API加载失败，请刷新页面重试")},200):showError("未找到卡牌ID，请返回首页重新选择")});var l,s,u,p,g,m,h=[],v=0;function initCardThreeJS(e,t){console.log("初始化Three.js，图片URL:",e);var n=document.getElementById("card-3d-container");if(n){var a=document.createElement("div");if(a.id="initial-loading",a.className="absolute inset-0 flex items-center justify-center z-20",a.innerHTML='\n        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>\n    ',n.appendChild(a),n.classList.add("debug-border"),console.log("容器尺寸:",n.clientWidth,"x",n.clientHeight),0===n.clientWidth||0===n.clientHeight)return console.warn("容器尺寸为0，延迟初始化Three.js"),void setTimeout(function(){return initCardThreeJS(e)},500);l=new THREE.Scene,n.addEventListener("click",function(e){var t=n.getBoundingClientRect();!function createExplosionEffect(e,t,n){var a=30,r=["explosion-particle-blue","explosion-particle-pink","explosion-particle-yellow","explosion-particle-green","explosion-particle-red"],c=Math.floor(5*Math.random())+1;n.className=n.className.replace(/card-color-theme-\d+/g,""),n.classList.add("card-color-theme-".concat(c));for(var l=function _loop(){var a=document.createElement("div");a.className="explosion-particle";var c=15*Math.random()+5;a.style.width="".concat(c,"px"),a.style.height="".concat(c,"px");var l=r[Math.floor(Math.random()*r.length)];a.classList.add(l),a.style.left="".concat(e,"px"),a.style.top="".concat(t,"px");var s=Math.random()*Math.PI*2,u=100*Math.random()+50,p=Math.cos(s)*u,g=Math.sin(s)*u;a.style.setProperty("--tx","".concat(p,"px")),a.style.setProperty("--ty","".concat(g,"px")),n.appendChild(a),setTimeout(function(){a.parentNode===n&&n.removeChild(a)},1e3)},s=0;s<a;s++)l()}(e.clientX-t.left,e.clientY-t.top,n)}),(s=new THREE.PerspectiveCamera(60,n.clientWidth/n.clientHeight,.1,1e3)).position.z=4,(u=new THREE.WebGLRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0})).setSize(n.clientWidth,n.clientHeight),u.setClearColor(0,0),u.setPixelRatio(window.devicePixelRatio),n.appendChild(u.domElement);var r=new THREE.AmbientLight(16777215,.7);l.add(r);var c=new THREE.DirectionalLight(16777215,.8);c.position.set(5,5,5),l.add(c);var h=new THREE.PointLight(6514417,1,10);h.position.set(2,2,2),l.add(h);var v=new THREE.SpotLight(16777215,.8);v.position.set(-5,5,5),v.angle=Math.PI/6,v.penumbra=.2,l.add(v);var y=new THREE.PointLight(65535,.5,15);y.position.set(-3,-3,2),l.add(y);var b=new THREE.PointLight(16711935,.5,15);b.position.set(3,3,2),l.add(b);var x=new THREE.PlaneGeometry(2.5,3.5);g=new THREE.MeshStandardMaterial({color:16777215,side:THREE.DoubleSide,metalness:.5,roughness:.5,transparent:!0,opacity:0,visible:!1}),p=new THREE.Mesh(x,g),l.add(p),m=new THREE.TextureLoader,e?loadCardTexture(e):showDefaultCardTheme(t),console.log("Three.js初始化完成 - 场景:",l),console.log("相机位置:",s.position),console.log("卡牌尺寸:",2.5,"x",3.5);var w=0,E=null,T=0,C=0,R=0,k=0;n.addEventListener("mousemove",function(e){var t=n.getBoundingClientRect();T=(e.clientX-t.left)/n.clientWidth*2-1,C=-(e.clientY-t.top)/n.clientHeight*2+1,createParticle(e.clientX-t.left,e.clientY-t.top,n)}),n.addEventListener("mouseleave",function(){k=0,R=0}),n.addEventListener("touchmove",function(e){if(e.touches.length>0){var t=n.getBoundingClientRect(),a=e.touches[0];T=(a.clientX-t.left)/n.clientWidth*2-1,C=-(a.clientY-t.top)/n.clientHeight*2+1,createParticle(a.clientX-t.left,a.clientY-t.top,n)}e.preventDefault()},{passive:!1}),n.addEventListener("touchend",function(){k=0,R=0}),window.addEventListener("resize",function onWindowResize(){s&&u&&n&&(s.aspect=n.clientWidth/n.clientHeight,s.updateProjectionMatrix(),u.setSize(n.clientWidth,n.clientHeight),u.setPixelRatio(window.devicePixelRatio),console.log("窗口大小已调整:",n.clientWidth,"x",n.clientHeight))}),function animate(){if(E=requestAnimationFrame(animate),l&&p&&u){w+=.01,k=.3*T,R=.2*C,p.rotation.y+=.1*(k-p.rotation.y),p.rotation.x+=.1*(R-p.rotation.x),p.position.y=.05*Math.sin(w),h&&(h.position.x=3*Math.sin(.7*w),h.position.z=3*Math.cos(.5*w)),y&&b&&(y.position.x=3*Math.sin(.5*w),y.position.y=3*Math.cos(.7*w),b.position.x=3*Math.cos(.3*w),b.position.y=3*Math.sin(.6*w));try{u.render(l,s)}catch(e){console.error("渲染错误:",e),cancelAnimationFrame(E)}}else console.warn("Three.js组件未初始化，跳过渲染")}(),console.log("动画循环已启动"),function bindCardNavigationEvents(){var e=document.getElementById("prev-card-btn"),t=document.getElementById("next-card-btn");e&&e.addEventListener("click",showPreviousCard);t&&t.addEventListener("click",showNextCard)}()}else console.error("找不到卡牌3D容器");function createParticle(e,t,n){if(!(Math.random()>.3)){var a=document.createElement("div");a.className="particle";var r=30*Math.random()+10;a.style.width="".concat(r,"px"),a.style.height="".concat(r,"px");var c=60*Math.random()+180;a.style.background="radial-gradient(circle, hsla(".concat(c,", 100%, 70%, 0.8) 0%, hsla(").concat(c,", 100%, 70%, 0) 70%)"),a.style.left="".concat(e,"px"),a.style.top="".concat(t,"px"),n.appendChild(a),setTimeout(function(){a.parentNode===n&&n.removeChild(a)},3e3)}}}function loadCardTexture(e){if(console.log("加载卡牌纹理:",e),m&&g)if(e&&!e.includes("undefined")){var t=document.getElementById("card-3d-container");if(t){var n=document.createElement("div");n.id="texture-loading",n.className="absolute inset-0 flex items-center justify-center z-10",n.innerHTML='\n            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>\n        ';var a=document.getElementById("texture-loading");a&&a.remove(),t.appendChild(n)}g.emissive.set(0),g.emissiveIntensity=0,g.metalness=.5,g.roughness=.5,g.transparent=!1,g.opacity=1,m.load(e,function(e){console.log("纹理加载成功"),e.encoding=THREE.sRGBEncoding||THREE.LinearEncoding,e.flipY=!0,e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.generateMipmaps=!0;var t=function createRoundedTexture(e){var t=document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});t.width=e.image.width,t.height=e.image.height;var a=.08*Math.min(t.width,t.height);n.clearRect(0,0,t.width,t.height),n.beginPath(),n.moveTo(a,0),n.lineTo(t.width-a,0),n.arcTo(t.width,0,t.width,a,a),n.lineTo(t.width,t.height-a),n.arcTo(t.width,t.height,t.width-a,t.height,a),n.lineTo(a,t.height),n.arcTo(0,t.height,0,t.height-a,a),n.lineTo(0,a),n.arcTo(0,0,a,0,a),n.closePath(),n.clip(),n.drawImage(e.image,0,0,t.width,t.height);var r=new THREE.Texture(t);return r.needsUpdate=!0,r.encoding=e.encoding,r.minFilter=e.minFilter,r.magFilter=e.magFilter,r.generateMipmaps=e.generateMipmaps,r}(e);g.map=t,g.transparent=!0,g.opacity=1,g.visible=!0,g.needsUpdate=!0;var n=document.getElementById("texture-loading");n&&n.remove();var a=document.getElementById("initial-loading");a&&a.remove(),console.log("圆角纹理已应用到材质")},function(e){console.log("纹理加载进度:",e.loaded/e.total*100+"%")},function(e){console.error("纹理加载失败:",e),showDefaultCardTheme()})}else showDefaultCardTheme();else console.error("纹理加载器或材质未初始化")}function showDefaultCardTheme(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(g){var t=document.getElementById("texture-loading");t&&t.remove();var n=document.getElementById("initial-loading");n&&n.remove();var a="N",r="卡牌";if(e)a=e.rarity||"N",r=e.name||"卡牌";else{var c=document.querySelector(".rarity-badge");c&&(a=c.textContent.trim());var l=document.querySelector(".card-name");l&&(r=l.textContent.trim())}!function createDefaultCardTexture(e,t){var n={N:{primary:"#6b7280",secondary:"#4b5563"},R:{primary:"#3b82f6",secondary:"#1e40af"},SR:{primary:"#8b5cf6",secondary:"#6d28d9"},SSR:{primary:"#f59e0b",secondary:"#d97706"},UR:{primary:"#ef4444",secondary:"#dc2626"},LR:{primary:"#ec4899",secondary:"#db2777"}},a=n[t]||n.N,r=document.createElement("canvas"),c=r.getContext("2d");r.width=600,r.height=840;var l=48;c.beginPath(),c.moveTo(l,0),c.lineTo(r.width-l,0),c.arcTo(r.width,0,r.width,l,l),c.lineTo(r.width,r.height-l),c.arcTo(r.width,r.height,r.width-l,r.height,l),c.lineTo(l,r.height),c.arcTo(0,r.height,0,r.height-l,l),c.lineTo(0,l),c.arcTo(0,0,l,0,l),c.closePath(),c.clip();var s=c.createLinearGradient(0,0,r.width,r.height);s.addColorStop(0,a.primary),s.addColorStop(1,a.secondary),c.fillStyle=s,c.fillRect(0,0,r.width,r.height),c.fillStyle="white",c.font="bold 48px Arial, sans-serif",c.textAlign="center",c.textBaseline="middle",c.shadowColor="rgba(0, 0, 0, 0.5)",c.shadowBlur=4,c.shadowOffsetX=2,c.shadowOffsetY=2;for(var u=r.width-80,p=e.split(""),m="",h=[],v=0;v<p.length;v++){var y=m+p[v];c.measureText(y).width>u&&v>0?(h.push(m),m=p[v]):m=y}h.push(m);var b=60,x=r.height/2-(h.length-1)*b/2;h.forEach(function(e,t){c.fillText(e,r.width/2,x+t*b)}),c.font="bold 32px Arial, sans-serif",c.fillStyle="rgba(255, 255, 255, 0.9)",c.fillText(t,r.width/2,r.height-60);var w=new THREE.Texture(r);w.needsUpdate=!0,w.encoding=THREE.sRGBEncoding||THREE.LinearEncoding,w.flipY=!0,w.minFilter=THREE.LinearFilter,w.magFilter=THREE.LinearFilter,w.generateMipmaps=!0,g.map=w,g.color.set(16777215),g.emissive.set(0),g.emissiveIntensity=0,g.metalness=.5,g.roughness=.5,g.transparent=!0,g.opacity=1,g.visible=!0,g.needsUpdate=!0}(r,a),console.log("✅ 显示默认卡牌主题 - 稀有度: ".concat(a,", 卡牌名称: ").concat(r))}}function updateCardTexture(e){console.log("更新卡牌纹理:",e),g&&p?!e||e.includes("undefined")||e.includes("via.placeholder.com")?showDefaultCardTheme():loadCardTexture(e):console.error("材质或网格未初始化")}function showPreviousCard(){h.length<=1||(v=(v-1+h.length)%h.length,updateCardDisplay())}function showNextCard(){h.length<=1||(v=(v+1)%h.length,updateCardDisplay())}function updateCardDisplay(){updateCardTexture(h[v]);var e=document.getElementById("current-card-index");e&&(e.textContent=(v+1).toString())}function loadRelatedCards(e,t){return _loadRelatedCards.apply(this,arguments)}function _loadRelatedCards(){return _loadRelatedCards=_asyncToGenerator(_regenerator().m(function _callee2(e,t){var n,r,c,l,s,u;return _regenerator().w(function(p){for(;;)switch(p.p=p.n){case 0:if(p.p=0,n=document.getElementById("related-cards")){p.n=1;break}return p.a(2);case 1:return n.innerHTML='\n            <div class="col-span-full flex justify-center items-center py-8">\n                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>\n                <span class="ml-3 text-gray-600">加载推荐中...</span>\n            </div>\n        ',r=[],p.p=2,p.n=3,window.CardAPI.getRelatedCards(e,t);case 3:(c=p.v)&&c.success&&c.data?(r=c.data,console.log("✅ 相关卡牌加载成功:",r.length)):console.error("❌ API响应格式错误:",c),p.n=5;break;case 4:p.p=4,s=p.v,console.error("❌ API调用失败:",s.message),window.HomeModule&&window.HomeModule.getCardsByCategory&&(r=window.HomeModule.getCardsByCategory(e,t))&&r.length>0&&console.log("✅ 从缓存中获取相关卡牌成功:",r.length);case 5:if(r&&0!==r.length){p.n=6;break}return n.innerHTML='\n                <div class="col-span-full text-center py-8">\n                    <p class="text-gray-500">暂无相关推荐卡牌</p>\n                </div>\n            ',p.a(2);case 6:r=r.slice(0,4),n.innerHTML="",r.forEach(function(e){var t=document.createElement("div");t.className="related-card bg-white shadow-md",t.innerHTML='\n                <a href="/card-detail.html?id='.concat(e.id,'" class="block">\n                    <div class="relative h-48 bg-gradient-to-br from-gray-100 to-gray-200 overflow-hidden">\n                        <img src="').concat(e.image,'" alt="').concat(e.name,"\" \n                             class=\"w-full h-full object-cover rounded-xl\"\n                             loading=\"lazy\"\n                             onerror=\"this.style.display='none'; this.parentElement.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'; this.parentElement.innerHTML='<div style=\\'display:flex;align-items:center;justify-content:center;height:100%;color:white;font-weight:bold;text-align:center;padding:20px;\\'>").concat(e.name,'</div>\'">\n                        \n                        \x3c!-- 稀有度标签 --\x3e\n                        <div class="absolute top-2 right-2 ').concat(a[e.rarity],' text-white px-2 py-1 rounded-full text-xs font-bold">\n                            ').concat(e.rarity,'\n                        </div>\n                    </div>\n                    \n                    <div class="p-4">\n                        <h3 class="text-lg font-bold text-gray-900 truncate">').concat(e.name,'</h3>\n                        <p class="text-sm text-gray-500 mb-2">').concat(e.category,'</p>\n                        <div class="text-lg font-bold text-indigo-600">¥').concat(e.price.toLocaleString(),"</div>\n                    </div>\n                </a>\n            "),n.appendChild(t)}),p.n=8;break;case 7:p.p=7,u=p.v,console.error("加载相关卡牌失败:",u),(l=document.getElementById("related-cards"))&&(l.innerHTML='\n                <div class="col-span-full text-center py-8">\n                    <p class="text-gray-500">加载相关推荐失败</p>\n                </div>\n            ');case 8:return p.a(2)}},_callee2,null,[[2,4],[0,7]])})),_loadRelatedCards.apply(this,arguments)}function showError(e){var t=document.getElementById("card-detail-container");t&&(t.innerHTML='\n            <div class="p-8 text-center">\n                <div class="text-red-500 mb-4">\n                    <svg class="mx-auto h-12 w-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>\n                    </svg>\n                </div>\n                <p class="text-gray-700 mb-4">'.concat(e,'</p>\n                <a href="/index.html" class="inline-block bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">\n                    返回首页\n                </a>\n            </div>\n        '))}function showNotification(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=document.createElement("div");n.className="fixed top-4 right-4 z-50 px-6 py-3 rounded-lg text-white font-medium transform transition-all duration-300 translate-x-full ".concat("success"===t?"bg-green-500":"error"===t?"bg-red-500":"bg-blue-500"),n.textContent=e,document.body.appendChild(n),setTimeout(function(){n.classList.remove("translate-x-full")},100),setTimeout(function(){n.classList.add("translate-x-full"),setTimeout(function(){document.body.removeChild(n)},300)},3e3)}window.updateQuantity=function updateQuantity(e){var t=document.getElementById("quantity");if(t){var n=parseInt(t.value)+e;n<1&&(n=1),n>99&&(n=99),t.value=n}},window.buyCard=function buyCard(e,t,n){var a=parseInt(document.getElementById("quantity").value)||1,r=n*a;confirm("确认购买 ".concat(a," 张 ").concat(t,"？\n总价：¥").concat(r.toLocaleString()))&&(console.log("购买卡牌:",{cardId:e,cardName:t,price:n,quantity:a,totalPrice:r}),showNotification("正在购买 ".concat(a," 张 ").concat(t,"..."),"info")),window.addToCart?window.addToCart(e,t,n,a):showNotification("已将 ".concat(a," 个 ").concat(t," 添加到购物车"),"success")}}},e=>{e.O(0,[502,955],()=>{return t=81935,e(e.s=t);var t});e.O()}]);